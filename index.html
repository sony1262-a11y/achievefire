<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="æŠ•è³‡é‡‘åº«">
<meta name="theme-color" content="#5f8571">
<link rel="apple-touch-icon" href="data:image/png;base64,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">
<title>æŠ•è³‡é‡‘åº«</title>
<style>
:root{
  --sage:#7a9e87;--sage-dk:#5f8571;--sage-pl:#c8ddd0;
  --bg:#f2f5f2;--card:#fff;--card2:#f7faf8;--bd:#e0ebe4;
  --tx:#2d3d32;--tx2:#6b8575;--tx3:#a0b8aa;
  --yw:#e8c96a;--yw-bg:#fdf8ea;
  --rd:#e07070;--rd-bg:#fdf0f0;
  --bl:#6b9fc9;--bl-bg:#eef4fb;
  --or:#e08030;--or-bg:#fef3ea;
  --gr:#34d399;--gr-bg:#e6f9f2;
  --nav-h:62px;
  --sb:34px;
  --st:70px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:-apple-system,'Noto Sans TC',sans-serif;background:var(--bg);color:var(--tx);
  max-width:430px;margin:0 auto;height:100vh;height:100dvh;display:flex;flex-direction:column}

.page{display:none;flex-direction:column;flex:1;overflow:hidden}
.page.active{display:flex}

/* HEADER */
.hdr{background:linear-gradient(155deg,var(--sage-dk),var(--sage));
  padding:calc(var(--st)+8px) 16px 14px;flex-shrink:0;position:relative;overflow:hidden;z-index:10}
.hdr::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;
  background:rgba(255,255,255,.06);border-radius:50%}
.hdr-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;position:relative;z-index:1}
.hdr-title{font-size:16px;font-weight:700;color:#fff}
.hdr-r{display:flex;align-items:center;gap:7px}
.mo-btn{background:rgba(255,255,255,.2);border:none;border-radius:18px;padding:5px 11px;
  color:#fff;font-size:13px;font-weight:700;font-family:inherit;cursor:pointer}
.hdr-ico{width:32px;height:32px;background:rgba(255,255,255,.18);border:none;border-radius:50%;
  color:#fff;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center}
/* FAB â€” sticky inside home scroll area */
.fab-wrap{position:sticky;bottom:calc(var(--nav-h)+16px+var(--sb));
  display:flex;justify-content:flex-end;padding-right:18px;
  pointer-events:none;z-index:100;margin-top:-52px;height:52px}
.fab{pointer-events:auto;background:var(--sage-dk);color:#fff;border:none;border-radius:28px;
  height:52px;padding:0 22px;font-size:15px;font-weight:700;font-family:inherit;
  cursor:pointer;display:flex;align-items:center;gap:5px;
  box-shadow:0 4px 20px rgba(95,133,113,.45)}
.fab:active{opacity:.82}
.hdr-row{display:flex;gap:6px;position:relative;z-index:1;padding:0 4px}
.hdr-c{flex:1;background:rgba(255,255,255,.14);border-radius:12px;padding:8px 11px}
.hdr-cl{font-size:9px;color:rgba(255,255,255,.65);margin-bottom:2px;display:flex;align-items:center;gap:3px}
.hdr-cd{width:5px;height:5px;border-radius:2px}
.hdr-cv{font-size:17px;font-weight:700;color:#fff;line-height:1.1}

/* SCROLL */
.pg-scroll{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
.ca{padding:11px 12px 0}

/* WIDGET CARDS */
.wrow{display:flex;gap:8px;margin-bottom:8px}
.wcard{background:var(--card);border-radius:15px;padding:11px 13px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);flex:1;min-width:0;
  display:flex;flex-direction:column}
.wcard.yw{background:var(--yw-bg)}
.wlb{font-size:10px;color:var(--tx2);font-weight:600;margin-bottom:4px}
.wvl{font-size:20px;font-weight:700;line-height:1.2;min-height:24px}
.wsb{font-size:10px;color:var(--tx3);margin-top:2px}
.wbg{display:inline-flex;align-items:center;padding:2px 7px;border-radius:9px;
  font-size:10px;font-weight:700;margin-top:4px;align-self:flex-start}
.ok{background:#e6f5eb;color:#3d9058}
.warn{background:#fef8e6;color:#b08820}
.danger{background:#fceaea;color:#b84040}
.mbar{height:3px;background:var(--bd);border-radius:2px;overflow:hidden;margin-top:6px}
.mbar-f{height:100%;border-radius:2px;transition:width .4s}

/* æ”¶æ”¯å¡ */
.inc-card{background:var(--card);border-radius:15px;padding:11px 13px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);margin-bottom:8px}
.inc-row{display:flex;gap:6px;margin-top:7px}
.inc-chip{flex:1;border-radius:10px;padding:7px 8px;text-align:center}
.ic-lb{font-size:9px;color:var(--tx2);margin-bottom:2px}
.ic-vl{font-size:14px;font-weight:700}

/* DAILY BUDGET */
.day-card{background:var(--card);border-radius:15px;padding:11px 13px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);margin-bottom:8px}
.day-inner{display:flex;align-items:center;gap:11px}
.day-info{flex:1}
.day-lbl{font-size:10px;font-weight:600;color:var(--tx2);margin-bottom:5px}
.day-br{display:flex;align-items:center;gap:5px;margin-bottom:3px}
.day-brl{font-size:9px;color:var(--tx3);width:20px}
.day-bg{flex:1;height:4px;background:var(--bd);border-radius:2px;overflow:hidden}
.day-bf{height:100%;border-radius:2px}
.day-bv{font-size:9px;font-weight:600;color:var(--tx2);width:50px;text-align:right}
.day-ft{font-size:10px;color:var(--tx3);margin-top:3px}

/* PM WIDGET */
.pm-w{background:var(--card);border-radius:15px;padding:11px 13px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);margin-bottom:8px}
.pm-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.pm-cols{display:flex;gap:6px}
.pm-col{flex:1;background:var(--card2);border-radius:10px;padding:7px 9px;border:1.5px solid var(--bd)}
.pm-col.alrt{border-color:var(--rd);background:var(--rd-bg)}
.pm-cn{font-size:9px;color:var(--tx2);font-weight:700;margin-bottom:1px}
.pm-cv{font-size:14px;font-weight:700}
.pm-cs{font-size:9px;color:var(--tx3)}
.pm-cb{height:3px;background:var(--bd);border-radius:2px;overflow:hidden;margin-top:4px}
.pm-cf{height:100%;border-radius:2px}

/* INVEST */
.iv-w{background:var(--card);border-radius:15px;padding:11px 13px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);margin-bottom:8px}
.iv-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.rt-bar{display:flex;height:6px;border-radius:3px;overflow:hidden;margin:3px 0}
.rt-ca{background:var(--yw)}.rt-st{background:var(--sage)}
.rt-lb{display:flex;justify-content:space-between;font-size:10px;margin-bottom:7px}
.sr{display:flex;align-items:center;gap:7px;padding:5px 0;border-bottom:1px solid var(--bd)}
.sr:last-child{border-bottom:none}
.sr-dot{width:7px;height:7px;border-radius:2px;flex-shrink:0}
.sr-inf{flex:1;min-width:0}
.sr-nm{font-size:12px;font-weight:700}.sr-cd{font-size:9px;color:var(--tx3)}
.sr-bar{height:2px;background:var(--bd);border-radius:1px;overflow:hidden;margin-top:2px}
.sr-bf{height:100%;border-radius:1px}
.sr-pct{font-size:10px;color:var(--tx2);width:26px;text-align:right}
.sr-bgt{font-size:10px;color:var(--tx3);width:44px;text-align:right}
.sr-rem{font-size:10px;font-weight:700;width:50px;text-align:right}

/* EXP LIST */
.exp-sec{padding:0 12px}
.exp-grp{margin-bottom:2px}
.exp-dt-hdr{display:flex;align-items:center;gap:7px;padding:8px 2px 4px}
.exp-dt-lbl{font-size:11px;color:var(--tx3);font-weight:700}
.exp-dt-amt{font-size:10px;color:var(--tx3)}
.exp-it{background:var(--card);border-radius:13px;padding:10px 11px;display:flex;align-items:center;
  gap:9px;margin-bottom:5px;box-shadow:0 1px 4px rgba(0,0,0,.04);position:relative;overflow:hidden;cursor:pointer}
.exp-ic{width:36px;height:36px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.exp-inf{flex:1;min-width:0}
.exp-nm{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.exp-me{font-size:10px;color:var(--tx3);margin-top:1px}
.exp-adv{font-size:9px;color:var(--or);font-weight:700;background:var(--or-bg);
  padding:1px 6px;border-radius:5px;margin-top:2px;display:inline-block}
.exp-am{font-size:14px;font-weight:700;flex-shrink:0}
.del-btn{position:absolute;right:0;top:0;bottom:0;background:var(--rd);color:#fff;border:none;
  width:0;overflow:hidden;cursor:pointer;font-size:12px;font-weight:700;transition:width .2s;
  display:flex;align-items:center;justify-content:center}
.exp-it.sw .del-btn{width:60px}
.empty-st{text-align:center;padding:32px 20px;color:var(--tx3)}
.bot-sp{height:calc(var(--nav-h)+20px+var(--sb))}

/* SEC HDR */
.sec-h{display:flex;justify-content:space-between;align-items:center;padding:10px 14px 6px}
.sec-t{font-size:14px;font-weight:700}.sec-s{font-size:11px;color:var(--tx2)}
.btn-tx{font-size:12px;color:var(--sage-dk);font-weight:700;background:none;border:none;cursor:pointer;font-family:inherit}

/* â•â•â• TODO PAGE â•â•â• */
.todo-pg{flex:1;overflow-y:auto;padding:0 12px}
.todo-hdr-mini{padding:calc(var(--st)+8px) 16px 12px;background:linear-gradient(155deg,var(--sage-dk),var(--sage));
  flex-shrink:0;position:relative;overflow:hidden}
.todo-hdr-mini::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;
  background:rgba(255,255,255,.06);border-radius:50%}
.todo-title{font-size:16px;font-weight:700;color:#fff;position:relative;z-index:1;
  display:flex;justify-content:space-between;align-items:center}

/* advance section */
.adv-sec{background:var(--card);border-radius:15px;margin:12px 0 8px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);overflow:hidden}
.adv-sec-hdr{padding:12px 14px;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center}
.adv-tot-badge{background:var(--or-bg);color:var(--or);font-size:11px;font-weight:700;
  padding:3px 9px;border-radius:9px}
.adv-person-card{padding:12px 14px;border-bottom:1px solid var(--bd)}
.adv-person-card:last-child{border-bottom:none}
.adv-person-top{display:flex;align-items:center;gap:10px;margin-bottom:7px}
.adv-av{width:36px;height:36px;border-radius:50%;background:var(--or-bg);border:2px solid var(--or);
  display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;
  color:var(--or);flex-shrink:0}
.adv-pname{font-size:14px;font-weight:700}
.adv-ptot{font-size:16px;font-weight:800;color:var(--or)}
.settle-btn{font-size:11px;padding:5px 12px;border-radius:9px;border:1.5px solid var(--or);
  color:var(--or);background:transparent;cursor:pointer;font-family:inherit;font-weight:700}
.settle-btn:active{background:var(--or-bg)}
.adv-item-row{display:flex;align-items:center;justify-content:space-between;
  padding:5px 0;border-top:1px dashed var(--bd)}
.adv-item-desc{font-size:12px;color:var(--tx2)}
.adv-item-dt{font-size:10px;color:var(--tx3);margin-top:1px}
.adv-item-amt{font-size:12px;font-weight:700;color:var(--or)}
.adv-empty{padding:20px;text-align:center;color:var(--tx3);font-size:13px}

/* settled history */
.settled-toggle{font-size:11px;color:var(--tx3);background:none;border:none;cursor:pointer;
  padding:8px 14px;width:100%;text-align:left;font-family:inherit}
.settled-row{display:flex;align-items:center;gap:9px;padding:8px 14px;border-top:1px solid var(--bd);opacity:.65}
.settled-ic{width:28px;height:28px;border-radius:50%;background:var(--gr-bg);border:1.5px solid var(--gr);
  display:flex;align-items:center;justify-content:center;font-size:11px;color:#2d8a5a;flex-shrink:0}

/* checklist section */
.ck-sec{background:var(--card);border-radius:15px;margin-bottom:8px;
  box-shadow:0 1px 5px rgba(0,0,0,.05);overflow:hidden}
.ck-sec-hdr{padding:12px 14px;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center}
.ck-it{display:flex;align-items:center;gap:9px;padding:11px 14px;border-bottom:1px solid var(--bd);cursor:pointer}
.ck-it:last-child{border-bottom:none}
.ck-box{width:22px;height:22px;border-radius:7px;border:2px solid var(--bd);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.ck-box.mn{background:var(--sage-dk);border-color:var(--sage-dk)}
.ck-box.au{background:var(--bl);border-color:var(--bl)}
.ck-lb{font-size:13px;font-weight:600;flex:1}
.ck-lb.dn{text-decoration:line-through;color:var(--tx3)}
.ck-badge{font-size:9px;padding:1px 6px;border-radius:5px;font-weight:700;flex-shrink:0}
.ck-au-b{background:var(--bl-bg);color:var(--bl)}
.ck-flex-b{background:var(--or-bg);color:var(--or)}
.ck-amt{font-size:12px;font-weight:700;color:var(--tx2);flex-shrink:0}
.ck-ed{font-size:12px;color:var(--tx3);background:none;border:none;cursor:pointer;padding:2px 6px}
.ck-done-foot{padding:10px 14px;text-align:center;font-size:12px;color:#3d9058;font-weight:700}

/* NAV */
.bot-nav{background:rgba(255,255,255,.96);backdrop-filter:blur(20px);border-top:1px solid var(--bd);
  display:flex;padding:6px 0 calc(4px + var(--sb));flex-shrink:0}
.nav-it{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 0;
  cursor:pointer;border:none;background:none;font-family:inherit}
.nav-ic{font-size:20px;line-height:1}
.nav-lb{font-size:9px;color:var(--tx3);font-weight:600}
.nav-it.active .nav-lb{color:var(--sage-dk);font-weight:700}
.n-dot{position:absolute;top:-3px;right:-5px;background:var(--rd);color:#fff;width:15px;height:15px;
  border-radius:50%;font-size:8px;font-weight:700;display:flex;align-items:center;justify-content:center}

/* SHEET */
.sh-ov{position:fixed;inset:0;background:rgba(0,0,0,.32);z-index:200;display:none;
  align-items:flex-end;backdrop-filter:blur(2px)}
/* Confirm modal */
.cfm-ov{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:999;
  display:none;align-items:center;justify-content:center;backdrop-filter:blur(3px)}
.cfm-ov.open{display:flex}
.cfm-box{background:#fff;border-radius:20px;padding:22px 20px 16px;width:min(320px,88vw);
  box-shadow:0 8px 40px rgba(0,0,0,.18);animation:popIn .2s cubic-bezier(.34,1.56,.64,1)}
@keyframes popIn{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
.cfm-ttl{font-size:16px;font-weight:700;margin-bottom:7px}
.cfm-msg{font-size:13px;color:var(--tx2);line-height:1.6;margin-bottom:16px}
.cfm-btns{display:flex;gap:8px}
.cfm-cancel{flex:1;padding:11px;border-radius:12px;border:1.5px solid var(--bd);
  background:var(--card2);font-size:14px;font-weight:700;font-family:inherit;cursor:pointer}
.cfm-ok{flex:1;padding:11px;border-radius:12px;border:none;
  background:var(--rd);color:#fff;font-size:14px;font-weight:700;font-family:inherit;cursor:pointer}
.cfm-ok.safe{background:var(--sage-dk)}
.sh-ov.open{display:flex}
.sheet{background:#fff;border-radius:24px 24px 0 0;padding:0 0 calc(22px + var(--sb));
  width:100%;max-height:92vh;overflow-y:auto;
  animation:slideUp .26s cubic-bezier(.34,1.36,.64,1)}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sh-hnd{width:36px;height:4px;background:var(--bd);border-radius:2px;margin:12px auto 14px}
.sh-ttl{text-align:center;font-size:17px;font-weight:700;margin-bottom:15px}
.sh-body{padding:0 17px}
.fg{margin-bottom:11px}
.flb{font-size:12px;font-weight:700;color:var(--tx2);margin-bottom:5px;display:block}
.fi{width:100%;background:var(--bg);border:1.5px solid var(--bd);border-radius:12px;
  padding:10px 12px;font-size:15px;font-family:inherit;color:var(--tx);outline:none;-webkit-appearance:none}
.fi:focus{border-color:var(--sage)}
.cpills-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;margin:0 -17px;padding:0 17px 4px}
.cpills{display:flex;gap:6px;width:max-content}
.cpill{padding:7px 13px;border-radius:18px;font-size:13px;font-weight:600;
  border:1.5px solid var(--bd);background:transparent;cursor:pointer;
  font-family:inherit;transition:all .15s;white-space:nowrap}
.cpill.sel{color:#fff;border-color:transparent}
.amt-w{background:var(--bg);border:1.5px solid var(--bd);border-radius:14px;
  padding:4px 14px;text-align:center;position:relative;margin-bottom:11px}
.amt-sym{position:absolute;left:14px;top:50%;transform:translateY(-50%);
  font-size:20px;color:var(--tx3);font-weight:700}
.amt-fi{font-size:26px;font-weight:700;text-align:center;border:none;background:transparent;
  color:var(--tx);width:100%;outline:none;padding:7px 0}
.tgl-row{display:flex;gap:7px}
.tgl{flex:1;padding:10px 6px;border-radius:12px;border:2px solid var(--bd);background:transparent;
  font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .15s;text-align:center}
.tgl.c{border-color:var(--sage);background:#e8f2ec;color:var(--sage-dk)}
.tgl.cc{border-color:var(--bl);background:var(--bl-bg);color:var(--bl)}
.tgl.yes{border-color:var(--or);background:var(--or-bg);color:var(--or)}
.adv-box{background:var(--or-bg);border:1.5px solid var(--or);border-radius:12px;
  padding:11px 13px;margin-bottom:11px;display:none}
.adv-box.show{display:block}
.adv-person-row{display:flex;align-items:center;gap:7px;background:#fff;border-radius:10px;
  padding:7px 10px;margin-bottom:6px;border:1.5px solid var(--or)}
.adv-pn{font-size:13px;font-weight:700;flex:1}
.adv-pi{width:90px;font-size:14px;font-weight:700;border:none;background:transparent;
  text-align:right;color:var(--or);outline:none;font-family:inherit}
.adv-prm{background:none;border:none;cursor:pointer;color:var(--tx3);font-size:16px;padding:2px 4px}
.adv-qb{display:inline-block;background:#fff;border:1.5px dashed var(--or);border-radius:16px;
  padding:3px 9px;font-size:11px;color:var(--or);cursor:pointer;
  margin:3px 3px 0 0;font-family:inherit}
.btn-sub{width:100%;background:var(--sage-dk);color:#fff;border:none;border-radius:14px;
  padding:14px;font-size:16px;font-weight:700;font-family:inherit;cursor:pointer;margin-top:6px}
.btn-sub:active{opacity:.85}
.btn-gr{background:#2d8a5a!important}
.btn-or{background:var(--or)!important}

/* ANALYSIS */
.an-pg{flex:1;overflow-y:auto;padding:12px 12px 100px}
.goal-card{background:linear-gradient(135deg,var(--sage-dk),var(--sage));border-radius:16px;
  padding:16px 18px;color:#fff;margin-bottom:12px}
.gc-n{font-size:28px;font-weight:800;letter-spacing:-1px}
.gc-bt{height:5px;background:rgba(255,255,255,.25);border-radius:3px;overflow:hidden;margin:8px 0 4px}
.gc-bf{height:100%;background:rgba(255,255,255,.8);border-radius:3px;transition:width .8s}
.gc-m{display:flex;justify-content:space-between;font-size:10px;opacity:.65}
.li-row{display:flex;align-items:center;gap:9px;padding:7px 0;border-bottom:1px solid var(--bd)}
.li-row:last-child{border-bottom:none}
.li-ic{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
.li-bg{height:4px;background:var(--bd);border-radius:2px;overflow:hidden;margin-top:3px}
.li-bf{height:100%;border-radius:2px}
.li-am{font-size:12px;font-weight:700;width:64px;text-align:right;flex-shrink:0}

/* SETTINGS */
.st-pg{flex:1;overflow-y:auto;padding:12px 12px 100px}
.st-gl{font-size:10px;color:var(--tx2);font-weight:700;letter-spacing:.5px;padding:0 3px 5px}
.st-sec{background:var(--card);border-radius:15px;overflow:hidden;margin-bottom:12px;
  box-shadow:0 1px 4px rgba(0,0,0,.04)}
.st-row{display:flex;align-items:center;gap:10px;padding:12px 13px;
  border-bottom:1px solid var(--bd);cursor:pointer}
.st-row:last-child{border-bottom:none}
.st-ri{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;
  justify-content:center;font-size:14px;flex-shrink:0}
.st-rt{flex:1}
.st-tt{font-size:14px;font-weight:600}
.st-sb{font-size:10px;color:var(--tx2);margin-top:1px}
.st-ar{color:var(--tx3);font-size:16px;margin-left:auto}
.mo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:0 17px 10px}
.mo-opt{padding:12px;border-radius:10px;border:1.5px solid var(--bd);background:transparent;
  font-family:inherit;font-size:14px;font-weight:600;cursor:pointer;text-align:center}
.mo-opt.sel{background:var(--sage-dk);color:#fff;border-color:var(--sage-dk)}
.mo-opt.has{border-color:var(--sage-pl);color:var(--sage-dk)}
.a-row{background:var(--card2);border:1.5px solid var(--bd);border-radius:12px;
  padding:11px 14px;display:flex;align-items:center;gap:10px;margin-bottom:8px}
.a-lb{font-size:12px;font-weight:600;color:var(--tx2);flex:1}
.a-sb{font-size:10px;color:var(--tx3)}
.a-inp{font-size:17px;font-weight:700;color:var(--tx);background:transparent;border:none;
  outline:none;width:130px;text-align:right;font-family:inherit}
.cdot{width:28px;height:28px;border-radius:50%;cursor:pointer;border:3px solid transparent}
.cdot.sel{border-color:var(--tx)}

::-webkit-scrollbar{display:none}
</style>
</head>
<body>

<!-- â•â• HOME â•â• -->
<div class="page active" id="pg-home">
  <div class="hdr">
    <div class="hdr-top">
      <div class="hdr-title">ğŸ’° æŠ•è³‡é‡‘åº«</div>
      <div class="hdr-r">
        <button class="mo-btn" id="mo-btn" onclick="openMoPicker()">2æœˆ â–¾</button>
        <button class="hdr-ico" onclick="openAssetEdit()">âœï¸</button>
      </div>
    </div>
    <div class="hdr-row">
      <div class="hdr-c">
        <div class="hdr-cl"><span class="hdr-cd" style="background:#b8ffcb"></span>æœ¬æœˆæ”¶å…¥</div>
        <div class="hdr-cv" id="hdr-inc" style="color:#c5ffd9">$0</div>
      </div>
      <div class="hdr-c">
        <div class="hdr-cl"><span class="hdr-cd" style="background:#ffdf90"></span>æœ¬æœˆæ”¯å‡º</div>
        <div class="hdr-cv" id="hdr-exp">$0</div>
      </div>
      <div class="hdr-c">
        <div class="hdr-cl"><span class="hdr-cd" style="background:#fff"></span>ç¾é‡‘</div>
        <div class="hdr-cv" id="hdr-bank">$0</div>
      </div>
    </div>
  </div>

  <div class="pg-scroll">
    <div class="ca">
      <!-- æ”¶æ”¯æ¦‚æ³ -->
      <div class="inc-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="wlb" style="margin:0">ğŸ’° æœ¬æœˆæ”¶æ”¯</div>
          <button class="btn-tx" onclick="openAddIncome()">ï¼‹ è¨˜æ”¶å…¥</button>
        </div>
        <div class="inc-row">
          <div class="inc-chip" style="background:var(--gr-bg)">
            <div class="ic-lb">æ”¶å…¥</div>
            <div class="ic-vl" id="ic-inc" style="color:#2d8a5a">$0</div>
          </div>
          <div class="inc-chip" style="background:var(--rd-bg)">
            <div class="ic-lb">æ”¯å‡º</div>
            <div class="ic-vl" id="ic-exp" style="color:var(--rd)">$0</div>
          </div>
          <div class="inc-chip" style="background:var(--card2);border:1.5px solid var(--bd)">
            <div class="ic-lb">çµé¤˜</div>
            <div class="ic-vl" id="ic-bal">$0</div>
          </div>
        </div>
        <!-- income records list -->
        <div id="inc-list" style="display:none;margin-top:7px;border-top:1px solid var(--bd);padding-top:7px"></div>
        <button id="inc-toggle-btn" onclick="toggleIncList()" style="display:none;
          width:100%;background:none;border:none;font-size:11px;color:var(--tx3);
          font-family:inherit;cursor:pointer;padding:5px 0 1px;text-align:center"></button>
      </div>

      <!-- ç”Ÿæ´»è²» + æŠ•è³‡ -->
      <div class="wrow">
        <div class="wcard yw">
          <div class="wlb">ğŸ›’ ç”Ÿæ´»è²»é¤˜é¡</div>
          <div class="wvl" id="w-lv" style="color:#9a7010">$0</div>
          <div class="wsb" style="font-size:9px">åƒ…è¨ˆã€Œç”Ÿæ´»è²»ã€é¡åˆ¥</div>
          <div id="w-lv-bg" class="wbg ok">âœ“ å……è£•</div>
          <div style="margin-top:auto;padding-top:6px" class="mbar">
            <div class="mbar-f" id="w-lv-bar" style="width:0%;background:var(--yw)"></div>
          </div>
        </div>
        <div class="wcard">
          <div class="wlb">ğŸ“Š æŠ•è³‡é¤˜é¡</div>
          <div class="wvl" id="w-iv" style="color:var(--sage-dk)">$0</div>
          <div class="wsb">å·²æŠ• <span id="w-iv-sp">$0</span></div>
          <div style="margin-top:auto;padding-top:6px" class="mbar">
            <div class="mbar-f" id="w-iv-bar" style="width:0%;background:var(--sage)"></div>
          </div>
        </div>
      </div>

      <!-- æ¯æ—¥é ç®— -->
      <div class="day-card">
        <div class="day-inner">
          <svg width="64" height="64" viewBox="0 0 64 64" style="flex-shrink:0">
            <circle cx="32" cy="32" r="25" fill="none" stroke="var(--bd)" stroke-width="7"/>
            <circle cx="32" cy="32" r="25" fill="none" stroke="var(--yw)" stroke-width="7"
              stroke-dasharray="157.08" id="day-arc" stroke-dashoffset="157.08"
              stroke-linecap="round" transform="rotate(-90 32 32)" style="transition:all .5s"/>
            <text x="32" y="29" text-anchor="middle" font-size="9.5" font-weight="700" fill="#9a7010" id="day-n1">$0</text>
            <text x="32" y="40" text-anchor="middle" font-size="7.5" fill="var(--tx3)">/å¤©</text>
          </svg>
          <div class="day-info">
            <div class="day-lbl">ç”Ÿæ´»è²»æ¯æ—¥å‰©é¤˜é ç®—</div>
            <div class="day-br">
              <div class="day-brl">å·²ç”¨</div>
              <div class="day-bg"><div class="day-bf" id="day-used-f" style="width:0%;background:var(--yw)"></div></div>
              <div class="day-bv" id="day-used-v">$0</div>
            </div>
            <div class="day-br">
              <div class="day-brl">å‰©é¤˜</div>
              <div class="day-bg"><div class="day-bf" id="day-rem-f" style="width:100%;background:#b0e8c8"></div></div>
              <div class="day-bv" id="day-rem-v">$0</div>
            </div>
            <div class="day-ft">æœ¬æœˆå‰© <strong id="day-days">30</strong> å¤©</div>
          </div>
        </div>
      </div>

      <!-- ä»˜æ¬¾è¿½è¹¤ -->
      <div class="pm-w">
        <div class="pm-h">
          <div class="wlb" style="margin:0">ğŸ’³ ä»˜æ¬¾æ–¹å¼ï¼ˆç”Ÿæ´»è²»ï¼‰</div>
          <span style="font-size:9px;color:var(--tx3)">é ç®— $<span id="pm-bgt-lbl">15,000</span></span>
        </div>
        <div class="pm-cols">
          <div class="pm-col" id="pm-ca-col">
            <div class="pm-cn">ğŸ’µ ç¾é‡‘</div>
            <div class="pm-cv" id="pm-ca">$0</div>
            <div class="pm-cs">æœ¬æœˆèŠ±è²»</div>
            <div class="pm-cb"><div class="pm-cf" id="pm-ca-bar" style="width:0%;background:var(--sage)"></div></div>
          </div>
          <div class="pm-col" id="pm-cc-col">
            <div class="pm-cn">ğŸ’³ ä¿¡ç”¨å¡</div>
            <div class="pm-cv" id="pm-cc">$0</div>
            <div class="pm-cs">æœ¬æœˆåˆ·å¡</div>
            <div class="pm-cb"><div class="pm-cf" id="pm-cc-bar" style="width:0%;background:var(--bl)"></div></div>
          </div>
          <div class="pm-col">
            <div class="pm-cn">ğŸ“Š åˆè¨ˆ</div>
            <div class="pm-cv" id="pm-tot">$0</div>
            <div class="pm-cs" id="pm-rem" style="color:var(--sage-dk)">å‰© $0</div>
          </div>
        </div>
      </div>

      <!-- æŠ•è³‡é…ç½® -->
      <div class="iv-w">
        <div class="iv-h">
          <div class="wlb" style="margin:0">ğŸ“ˆ æŠ•è³‡é…ç½®</div>
          <span id="alloc-lbl" style="font-size:10px;color:var(--sage-dk);font-weight:700">å‡è¡¡ âœ“</span>
        </div>
        <div class="rt-bar">
          <div class="rt-ca" id="rt-ca" style="width:30%"></div>
          <div class="rt-st" id="rt-st" style="width:70%"></div>
        </div>
        <div class="rt-lb">
          <span style="color:#9a7010;font-weight:600">ğŸ¦ ç¾é‡‘ <span id="rt-ca-p">30%</span></span>
          <span style="color:var(--tx3)">ç›®æ¨™ 30:70</span>
          <span style="color:var(--sage-dk);font-weight:600">ğŸ“ˆ è‚¡ç¥¨ <span id="rt-st-p">70%</span></span>
        </div>
        <div id="sr-list"></div>
      </div>
    </div><!-- .ca -->

    <!-- æ¶ˆè²»æ˜ç´° -->
    <div class="sec-h">
      <div><div class="sec-t">æ¶ˆè²»æ˜ç´°</div><div class="sec-s" id="exp-sub">æœ¬æœˆ $0</div></div>
      <button class="btn-tx" onclick="showPage('pg-analysis')">åˆ†æ â†’</button>
    </div>
    <div class="exp-sec" id="exp-container"></div>
    <!-- FAB anchored inside scroll -->
    <div class="fab-wrap">
      <button class="fab" onclick="openAddExp()">ï¼‹ è¨˜ä¸€ç­†</button>
    </div>
    <div class="bot-sp"></div>
  </div>
</div>

<!-- â•â• TODO PAGE â•â• -->
<div class="page" id="pg-todo">
  <div class="todo-hdr-mini">
    <div class="todo-title">
      <span>ğŸ“‹ å¾…è¾¦è¿½è¹¤</span>
      <button class="mo-btn" id="todo-mo-btn" onclick="openMoPicker()">2æœˆ â–¾</button>
    </div>
  </div>
  <div class="todo-pg">

    <!-- ä»£å¢Šè¿½è¨ -->
    <div class="adv-sec">
      <div class="adv-sec-hdr">
        <div>
          <div style="font-size:14px;font-weight:700">ğŸ¤ ä»£å¢Šè¿½è¨</div>
          <div style="font-size:10px;color:var(--tx3);margin-top:1px">è¨˜å¸³æ™‚å‹¾é¸ã€Œæˆ‘å…ˆå¢Šã€å³è‡ªå‹•è¨˜éŒ„</div>
        </div>
        <span class="adv-tot-badge" id="adv-grand-badge" style="display:none"></span>
      </div>
      <div id="adv-list"></div>
    </div>

    <!-- ä»£å¢Šæ”¶å›ç´€éŒ„ -->
    <div class="adv-sec" id="settled-sec" style="display:none">
      <button class="settled-toggle" onclick="toggleSettled()">
        <span id="settled-toggle-lbl">â–¶ å·²æ”¶å›ç´€éŒ„</span>
      </button>
      <div id="settled-list" style="display:none"></div>
    </div>

    <!-- æœ¬æœˆå›ºå®šæ¸…å–® -->
    <div class="ck-sec" style="margin-top:8px">
      <div class="ck-sec-hdr">
        <div>
          <div style="font-size:14px;font-weight:700">ğŸ“‹ æœ¬æœˆå›ºå®š</div>
          <div style="font-size:10px;color:var(--tx3);margin-top:1px" id="ck-fixed-prog">0/0 å®Œæˆ</div>
        </div>
        <button class="btn-tx" onclick="openAddFixed()">ï¼‹ æ–°å¢</button>
      </div>
      <div id="ck-fixed-list"></div>
    </div>

    <!-- è‡ªè¨‚å¾…è¾¦ -->
    <div class="ck-sec" style="margin-top:8px">
      <div class="ck-sec-hdr">
        <div style="font-size:14px;font-weight:700">âœï¸ è‡ªè¨‚å¾…è¾¦</div>
        <button class="btn-tx" onclick="openAddTask()">ï¼‹</button>
      </div>
      <div id="ck-custom-list">
        <div class="adv-empty">é»å³ä¸Šã€Œï¼‹ã€æ–°å¢è‡ªè¨‚å¾…è¾¦</div>
      </div>
    </div>

    <div class="bot-sp"></div>
  </div>
</div>

<!-- â•â• ANALYSIS â•â• -->
<div class="page" id="pg-analysis">
  <div class="hdr" style="padding-bottom:12px">
    <div class="hdr-top" style="margin-bottom:0">
      <div class="hdr-title">ğŸ“Š èŠ±è²»åˆ†æ</div>
      <div class="hdr-r"><button class="mo-btn" id="an-mo-btn" onclick="openMoPicker()">2æœˆ â–¾</button></div>
    </div>
  </div>
  <div class="an-pg">
    <div class="goal-card">
      <div style="font-size:10px;opacity:.7;margin-bottom:3px">å¹´åº¦è²¡å‹™ç›®æ¨™</div>
      <div class="gc-n" id="a-tot">$0</div>
      <div style="font-size:10px;opacity:.6;margin-top:1px">ç›®æ¨™ $1,000,000</div>
      <div class="gc-bt"><div class="gc-bf" id="a-gb" style="width:0%"></div></div>
      <div class="gc-m"><span id="a-pct">0%</span><span id="a-rem">é‚„å·® $1,000,000</span></div>
    </div>
    <div style="background:var(--card);border-radius:15px;padding:12px 14px;
      box-shadow:0 1px 4px rgba(0,0,0,.04);margin-bottom:12px">
      <div style="font-size:12px;font-weight:700;color:var(--tx2);margin-bottom:8px">æœ¬æœˆæ”¯å‡ºåˆ†æ</div>
      <div style="display:flex;justify-content:center;padding:6px 0">
        <canvas id="donut" width="160" height="160"></canvas></div>
      <div id="donut-leg"></div>
    </div>
    <div class="sec-h" style="padding:0 2px 7px"><div class="sec-t">å¹´åº¦æœˆè¦½</div></div>
    <div id="year-list"></div>
  </div>
</div>

<!-- â•â• SETTINGS â•â• -->
<div class="page" id="pg-settings">
  <div class="hdr" style="padding-bottom:12px">
    <div class="hdr-top" style="margin-bottom:0"><div class="hdr-title">âš™ï¸ è¨­å®š</div></div>
  </div>
  <div class="st-pg">
    <div class="st-gl">è³‡ç”¢</div>
    <div class="st-sec">
      <div class="st-row" onclick="openAssetEdit()">
        <div class="st-ri" style="background:#e8f2ec">ğŸ“ˆ</div>
        <div class="st-rt"><div class="st-tt">æ›´æ–°è³‡ç”¢æ•¸å€¼</div>
          <div class="st-sb" id="st-asset-sb">è‚¡ç¥¨ $0 ï½œç¾é‡‘ $0</div></div>
        <div class="st-ar">â€º</div>
      </div>
      <div class="st-row" onclick="openInvestEdit()">
        <div class="st-ri" style="background:var(--bl-bg)">ğŸ“Š</div>
        <div class="st-rt"><div class="st-tt">æŠ•è³‡é…ç½®</div><div class="st-sb">ç®¡ç† ETF æ¯”ä¾‹</div></div>
        <div class="st-ar">â€º</div>
      </div>
    </div>
    <div class="st-gl">é ç®—</div>
    <div class="st-sec">
      <div class="st-row" onclick="openBudgetEdit()">
        <div class="st-ri" style="background:var(--yw-bg)">ğŸ›’</div>
        <div class="st-rt"><div class="st-tt">ç”Ÿæ´»è²»æœˆé ç®—</div>
          <div class="st-sb" id="st-bgt-sb">$15,000 / æœˆ</div></div>
        <div class="st-ar">â€º</div>
      </div>
    </div>
    <div class="st-gl">æœˆåº¦å›ºå®šæ¸…å–®</div>
    <div class="st-sec" id="st-fixed-sec"></div>
    <div class="st-gl">æ¶ˆè²»é¡åˆ¥ï¼ˆç”Ÿæ´»è²»å¤§é¡ï¼‰</div>
    <div class="st-sec">
      <div style="display:flex;flex-wrap:wrap;gap:5px;padding:10px 13px" id="st-cats"></div>
      <div class="st-row" onclick="openAddCat()">
        <div class="st-ri" style="background:var(--bg)">ï¼‹</div>
        <div class="st-rt"><div class="st-tt">æ–°å¢å¤§é¡åˆ¥</div></div>
        <div class="st-ar">â€º</div>
      </div>
    </div>
    <div class="st-gl">ç”Ÿæ´»è²»å­é¡åˆ¥</div>
    <div class="st-sec">
      <div style="display:flex;flex-wrap:wrap;gap:5px;padding:10px 13px" id="st-subcats"></div>
      <div class="st-row" onclick="openAddSubCat()">
        <div class="st-ri" style="background:var(--yw-bg)">ï¼‹</div>
        <div class="st-rt"><div class="st-tt">æ–°å¢å­é¡åˆ¥</div>
          <div class="st-sb">è¨˜å¸³æ™‚é¸ã€Œç”Ÿæ´»è²»ã€å³å¯é¸æ“‡å­é¡åˆ¥</div></div>
        <div class="st-ar">â€º</div>
      </div>
    </div>
    <div class="st-gl">è³‡æ–™</div>
    <div class="st-sec">
      <div class="st-row" onclick="exportData()">
        <div class="st-ri" style="background:var(--bl-bg)">ğŸ“¥</div>
        <div class="st-rt"><div class="st-tt">åŒ¯å‡ºå‚™ä»½</div></div><div class="st-ar">â€º</div>
      </div>
      <div class="st-row" onclick="importData()">
        <div class="st-ri" style="background:var(--bl-bg)">ğŸ“¤</div>
        <div class="st-rt"><div class="st-tt">åŒ¯å…¥å‚™ä»½</div></div><div class="st-ar">â€º</div>
      </div>
      <div class="st-row" onclick="clearAll()">
        <div class="st-ri" style="background:var(--rd-bg)">ğŸ—‘</div>
        <div class="st-rt"><div class="st-tt" style="color:var(--rd)">æ¸…é™¤æ‰€æœ‰è³‡æ–™</div></div><div class="st-ar">â€º</div>
      </div>
    </div>
    <div style="background:var(--card);border-radius:15px;padding:14px;margin-bottom:12px;
      box-shadow:0 1px 4px rgba(0,0,0,.04)">
      <div style="font-size:13px;font-weight:700;margin-bottom:7px">ğŸ“± å®‰è£æˆ App</div>
      <div style="font-size:12px;color:var(--tx2);line-height:1.8">
        Safari é–‹å•Ÿ â†’ é»ã€Œåˆ†äº«ã€â‹ â†’ ã€ŒåŠ å…¥ä¸»ç•«é¢ã€<br>
        <span style="color:var(--sage-dk);font-weight:700">âœ“ å…¨è¢å¹•ï¼ŒåƒçœŸæ­£ Appï¼</span>
      </div>
    </div>
  </div>
</div>

<!-- NAV -->
<div class="bot-nav">
  <button class="nav-it active" id="nav-home" onclick="showPage('pg-home')">
    <div class="nav-ic">ğŸ’°</div><div class="nav-lb" style="color:var(--sage-dk)">è¨˜å¸³</div>
  </button>
  <button class="nav-it" id="nav-todo" onclick="showPage('pg-todo')">
    <div style="position:relative;display:inline-block">
      <div class="nav-ic">ğŸ“‹</div>
      <div id="n-dot" class="n-dot" style="display:none">!</div>
    </div>
    <div class="nav-lb">å¾…è¾¦</div>
  </button>
  <button class="nav-it" id="nav-analysis" onclick="showPage('pg-analysis')">
    <div class="nav-ic">ğŸ“Š</div><div class="nav-lb">åˆ†æ</div>
  </button>
  <button class="nav-it" id="nav-settings" onclick="showPage('pg-settings')">
    <div class="nav-ic">âš™ï¸</div><div class="nav-lb">è¨­å®š</div>
  </button>
</div>


<!-- â•â• SHEETS â•â• -->

<!-- ADD EXPENSE -->
<div class="sh-ov" id="sh-exp">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div>
    <div class="sh-ttl">è¨˜ä¸€ç­†</div>
    <div class="sh-body">
      <div class="amt-w">
        <span class="amt-sym">$</span>
        <input class="amt-fi" type="number" id="e-amt" placeholder="0" inputmode="decimal">
      </div>
      <div class="fg"><label class="flb">èªªæ˜</label>
        <input class="fi" type="text" id="e-desc" placeholder="èŠ±äº†ä»€éº¼ï¼Ÿ"></div>
      <div class="fg"><label class="flb">é¡åˆ¥</label>
        <div class="cpills-wrap"><div class="cpills" id="e-pills"></div></div>
        <!-- sub-category: shown only when ç”Ÿæ´»è²» is selected -->
        <div id="e-sub-wrap" style="display:none;margin-top:8px">
          <div style="font-size:10px;color:var(--tx2);font-weight:600;margin-bottom:5px">
            ğŸ›’ ç”Ÿæ´»è²»å­é¡åˆ¥</div>
          <div class="cpills-wrap"><div class="cpills" id="e-sub-pills"></div></div>
        </div>
        <div id="e-stk-wrap" style="display:none;margin-top:8px">
          <label class="flb">æŠ•è³‡æ¨™çš„</label>
          <select class="fi" id="e-stk" style="font-size:14px"></select>
        </div>
      </div>
      <div class="fg"><label class="flb">ä»˜æ¬¾æ–¹å¼</label>
        <div class="tgl-row">
          <button class="tgl c" id="pm-ca-btn" onclick="setPM('cash')">ğŸ’µ ç¾é‡‘</button>
          <button class="tgl" id="pm-cc-btn" onclick="setPM('cc')">ğŸ’³ ä¿¡ç”¨å¡</button>
        </div>
      </div>
      <div class="fg"><label class="flb">ä»£å¢Šï¼Ÿ</label>
        <div class="tgl-row">
          <button class="tgl" id="adv-no-btn" onclick="setAdv(false)"
            style="border-color:var(--bd);background:var(--card2);color:var(--tx2)">å¦ï¼Œè‡ªå·±ä»˜</button>
          <button class="tgl" id="adv-yes-btn" onclick="setAdv(true)">ğŸ¤ æˆ‘å…ˆå¢Š</button>
        </div>
      </div>
      <div class="adv-box" id="adv-box">
        <div style="font-size:10px;color:var(--or);margin-bottom:9px;line-height:1.6">
          ğŸ’¡ åŠ å…¥å„äººå¾Œï¼Œè¼¸å…¥å„è‡ªæ‡‰é‚„çš„é‡‘é¡ï¼ˆä¸éœ€å‡åˆ†ï¼‰
        </div>
        <div id="adv-quick" style="margin-bottom:8px"></div>
        <div style="display:flex;gap:6px;margin-bottom:9px">
          <input class="fi" type="text" id="adv-inp" placeholder="è¼¸å…¥å§“å" style="flex:1;font-size:14px">
          <button onclick="advAdd()" style="background:var(--or);color:#fff;border:none;
            border-radius:10px;padding:0 13px;font-size:17px;cursor:pointer;font-weight:700">ï¼‹</button>
        </div>
        <div id="adv-rows"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;
          padding-top:7px;border-top:1px dashed var(--or);margin-top:3px">
          <span style="font-size:11px;color:var(--or);font-weight:700">ä»£å¢Šåˆè¨ˆ</span>
          <span style="font-size:15px;font-weight:800;color:var(--or)" id="adv-total">$0</span>
        </div>
      </div>
      <button class="btn-sub" onclick="submitExp()">ç¢ºèªè¨˜å¸³</button>
    </div>
  </div>
</div>

<!-- ADD INCOME -->
<div class="sh-ov" id="sh-income">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">è¨˜éŒ„æ”¶å…¥</div>
    <div class="sh-body">
      <div class="amt-w">
        <span class="amt-sym" style="color:#2d8a5a">$</span>
        <input class="amt-fi" type="number" id="inc-amt" placeholder="0" inputmode="decimal" style="color:#2d8a5a">
      </div>
      <div class="fg"><label class="flb">ä¾†æºèªªæ˜</label>
        <input class="fi" type="text" id="inc-desc" placeholder="è–ªæ°´ã€çé‡‘ã€å…¼è·â€¦"></div>
      <button class="btn-sub btn-gr" onclick="submitIncome()">è¨˜éŒ„æ”¶å…¥</button>
    </div>
  </div>
</div>

<!-- ADD TASK -->
<div class="sh-ov" id="sh-task">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">æ–°å¢è‡ªè¨‚å¾…è¾¦</div>
    <div class="sh-body">
      <div class="fg"><label class="flb">é …ç›®åç¨±</label>
        <input class="fi" type="text" id="task-nm" placeholder="ä¾‹ï¼šç¹³ä¿¡ç”¨å¡"></div>
      <div class="fg"><label class="flb">é‡‘é¡ï¼ˆé¸å¡«ï¼‰</label>
        <input class="fi" type="number" id="task-amt" placeholder="0" inputmode="decimal"></div>
      <button class="btn-sub" onclick="submitTask()">æ–°å¢</button>
    </div>
  </div>
</div>

<!-- EDIT FIXED -->
<div class="sh-ov" id="sh-fixed">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div>
    <div class="sh-ttl" id="sh-fixed-ttl">å›ºå®šæ”¯å‡ºè¨­å®š</div>
    <div class="sh-body">
      <div class="fg"><label class="flb">åç¨±</label>
        <input class="fi" type="text" id="fx-nm" placeholder="æˆ¿è²¸ã€æ°´è²»â€¦"></div>
      <div class="fg"><label class="flb">åœ–ç¤º</label>
        <input class="fi" type="text" id="fx-ico" placeholder="ğŸ " maxlength="2"></div>
      <div class="fg"><label class="flb">å›ºå®šé‡‘é¡ï¼ˆ0 = æµ®å‹•ï¼Œä¾‹å¦‚æ°´é›»è²»ï¼‰</label>
        <input class="fi" type="number" id="fx-amt" placeholder="0" inputmode="decimal"></div>
      <div class="fg">
        <label class="flb">ç¶å®šé¡åˆ¥ â†’ è¨˜å¸³é¸æ­¤é¡åˆ¥è‡ªå‹•æ‰“å‹¾</label>
        <div class="cpills-wrap" style="margin:5px 0 0">
          <div class="cpills" id="fx-cat-pills"></div>
        </div>
      </div>
      <button class="btn-sub" onclick="submitFixed()">å„²å­˜</button>
    </div>
  </div>
</div>

<!-- SETTLE CONFIRM -->
<div class="sh-ov" id="sh-settle">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div>
    <div class="sh-ttl">æ”¶å›ä»£å¢Š ğŸ’°</div>
    <div class="sh-body">
      <!-- person summary -->
      <div id="settle-preview" style="background:var(--or-bg);border-radius:14px;padding:14px;margin-bottom:14px"></div>
      <!-- editable amount -->
      <div class="fg">
        <label class="flb">æ”¶å›é‡‘é¡</label>
        <div class="amt-w">
          <span class="amt-sym" style="color:#2d8a5a">$</span>
          <input class="amt-fi" type="number" id="settle-amt" inputmode="decimal" style="color:#2d8a5a">
        </div>
      </div>
      <!-- editable desc -->
      <div class="fg">
        <label class="flb">å‚™è¨»</label>
        <input class="fi" type="text" id="settle-desc" placeholder="ä»£å¢Šæ”¶å›">
      </div>
      <!-- record as income toggle -->
      <div class="fg">
        <label class="flb">åŒæ™‚è¨˜ç‚ºæ”¶å…¥ï¼Ÿ</label>
        <div class="tgl-row">
          <button class="tgl c" id="settle-inc-yes" onclick="setSettleInc(true)">âœ“ æ˜¯ï¼Œè¨˜å…¥æœ¬æœˆæ”¶å…¥</button>
          <button class="tgl" id="settle-inc-no" onclick="setSettleInc(false)">å¦ï¼Œåªæ¨™è¨˜æ”¶å›</button>
        </div>
      </div>
      <div id="settle-inc-note" style="font-size:11px;color:#2d8a5a;background:var(--gr-bg);
        border-radius:10px;padding:9px 12px;margin-bottom:12px;line-height:1.6">
        âœ“ æ”¶å›çš„é‡‘é¡å°‡è‡ªå‹•æ–°å¢è‡³æœ¬æœˆæ”¶å…¥ç´€éŒ„
      </div>
      <button class="btn-sub btn-or" id="settle-confirm-btn">âœ“ ç¢ºèªæ”¶å›</button>
    </div>
  </div>
</div>

<!-- BUDGET -->
<div class="sh-ov" id="sh-budget">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">ç”Ÿæ´»è²»æœˆé ç®—</div>
    <div class="sh-body">
      <div class="amt-w">
        <span class="amt-sym">$</span>
        <input class="amt-fi" type="number" id="budget-inp" inputmode="decimal">
      </div>
      <div style="font-size:11px;color:var(--tx3);text-align:center;margin-bottom:14px">
        åƒ…ã€Œç”Ÿæ´»è²»ã€é¡åˆ¥è¨ˆå…¥æ­¤é ç®—</div>
      <button class="btn-sub" onclick="saveBudget()">å„²å­˜</button>
    </div>
  </div>
</div>

<!-- ASSET -->
<div class="sh-ov" id="sh-asset">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">æ›´æ–°è³‡ç”¢</div>
    <div class="sh-body">
      <div class="a-row">
        <div><div class="a-lb">ğŸ“ˆ è‚¡ç¥¨å¸‚å€¼</div>
          <div class="a-sb">00662/0050/00878/00830</div></div>
        <input class="a-inp" type="number" id="a-stk" inputmode="decimal" oninput="prvAlloc()">
      </div>
      <div class="a-row">
        <div><div class="a-lb">ğŸ’µ ç¾é‡‘ï¼ˆéŠ€è¡Œï¼‰</div></div>
        <input class="a-inp" type="number" id="a-bank" inputmode="decimal" oninput="prvAlloc()">
      </div>
      <div style="background:var(--card2);border-radius:12px;padding:11px;margin:7px 0">
        <div style="font-size:11px;font-weight:700;color:var(--tx2);margin-bottom:6px">é…æ¯”é è¦½</div>
        <div class="rt-bar" style="margin:0 0 4px">
          <div class="rt-ca" id="pv-ca" style="width:30%"></div>
          <div class="rt-st" id="pv-st" style="width:70%"></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:11px">
          <span style="color:#9a7010">ğŸ’µ ç¾é‡‘ <span id="pv-cp">30%</span></span>
          <span style="color:var(--sage-dk)">ğŸ“ˆ è‚¡ç¥¨ <span id="pv-sp">70%</span></span>
        </div>
      </div>
      <button class="btn-sub" onclick="saveAssets()">å„²å­˜</button>
    </div>
  </div>
</div>

<!-- INVEST -->
<div class="sh-ov" id="sh-invest">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">æŠ•è³‡é…ç½®</div>
    <div class="sh-body">
      <div id="iv-edit-body"></div>
      <div style="text-align:center;font-size:11px;color:var(--tx3);margin:7px 0 12px">
        åˆè¨ˆ <span id="iv-tot-p" style="color:var(--sage-dk);font-weight:700">100%</span>
      </div>
      <button class="btn-sub" onclick="closeSheet('sh-invest');renderHome()">å®Œæˆ</button>
    </div>
  </div>
</div>

<!-- MONTH PICKER -->
<div class="sh-ov" id="sh-mo">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">é¸æ“‡æœˆä»½</div>
    <div class="mo-grid" id="mo-grid"></div>
  </div>
</div>

<!-- ADD CAT -->
<div class="sh-ov" id="sh-cat">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">æ–°å¢å¤§é¡åˆ¥</div>
    <div class="sh-body">
      <div class="fg"><label class="flb">åç¨±</label>
        <input class="fi" type="text" id="nc-nm" placeholder="ç¾é£Ÿ"></div>
      <div class="fg"><label class="flb">åœ–ç¤º</label>
        <input class="fi" type="text" id="nc-ico" placeholder="ğŸœ" maxlength="2"></div>
      <div class="fg"><label class="flb">é¡è‰²</label>
        <div style="display:flex;gap:7px;flex-wrap:wrap" id="nc-clrs"></div></div>
      <button class="btn-sub" onclick="submitCat()">æ–°å¢</button>
    </div>
  </div>
</div>

<div class="sh-ov" id="sh-subcat">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sh-hnd"></div><div class="sh-ttl">æ–°å¢ç”Ÿæ´»è²»å­é¡åˆ¥</div>
    <div class="sh-body">
      <div style="font-size:11px;color:var(--tx2);background:var(--yw-bg);border-radius:10px;
        padding:9px 12px;margin-bottom:12px">
        ğŸ›’ å­é¡åˆ¥æœƒåœ¨è¨˜å¸³é¸ã€Œç”Ÿæ´»è²»ã€æ™‚å‡ºç¾ï¼Œä¸¦åœ¨åˆ†æåœ–é¡¯ç¤ºæ˜ç´°
      </div>
      <div class="fg"><label class="flb">åç¨±</label>
        <input class="fi" type="text" id="sc-nm" placeholder="é¤é£²ã€äº¤é€šâ€¦"></div>
      <div class="fg"><label class="flb">åœ–ç¤º</label>
        <input class="fi" type="text" id="sc-ico" placeholder="ğŸœ" maxlength="2"></div>
      <div class="fg"><label class="flb">é¡è‰²</label>
        <div style="display:flex;gap:7px;flex-wrap:wrap" id="sc-clrs"></div></div>
      <button class="btn-sub" onclick="submitSubCat()">æ–°å¢å­é¡åˆ¥</button>
    </div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="cfm-ov" id="cfm-modal">
  <div class="cfm-box">
    <div class="cfm-ttl" id="cfm-ttl">ç¢ºèª</div>
    <div class="cfm-msg" id="cfm-msg"></div>
    <div class="cfm-btns">
      <button class="cfm-cancel" onclick="cfmClose()">å–æ¶ˆ</button>
      <button class="cfm-ok" id="cfm-ok">ç¢ºèª</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA MODEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CLRS=['#e07070','#e8c96a','#7a9e87','#6b9fc9','#c084fc','#f97316','#34d399','#fb7185','#4a9e65','#a78bfa'];
const GOAL=1000000, IV_BDG=20000;

function defData(){return{
  livingBudget:15000,
  stockValue:360000, bankValue:160000,
  // TOP-LEVEL categories (shown as main pills)
  cats:[
    {name:'ç”Ÿæ´»è²»',icon:'ğŸ›’',color:'#e8c96a',sys:true},
    {name:'æŠ•è³‡',icon:'ğŸ“ˆ',color:'#7a9e87',sys:true},
    {name:'æˆ¿è²¸',icon:'ğŸ ',color:'#5f8571',sys:true},
    {name:'ç®¡ç†è²»',icon:'ğŸ¢',color:'#6b9fc9',sys:true},
    {name:'ç¶²è·¯è²»',icon:'ğŸŒ',color:'#a78bfa',sys:true},
    {name:'æ°´è²»',icon:'ğŸ’§',color:'#6bcfc9',sys:true},
    {name:'é›»è²»',icon:'âš¡',color:'#e2b84a',sys:true},
    {name:'ç“¦æ–¯è²»',icon:'ğŸ”¥',color:'#e08030',sys:true},
  ],
  // SUB-CATEGORIES under ç”Ÿæ´»è²»
  subCats:[
    {name:'é¤é£²',icon:'ğŸœ',color:'#e07070'},
    {name:'äº¤é€š',icon:'ğŸšŒ',color:'#b0c4de'},
    {name:'å¨›æ¨‚',icon:'ğŸ¬',color:'#c084fc'},
    {name:'è³¼ç‰©',icon:'ğŸ›',color:'#f97316'},
    {name:'é†«ç™‚',icon:'ğŸ’Š',color:'#34d399'},
    {name:'å…¶ä»–',icon:'ğŸ“¦',color:'#a0b8aa'},
  ],
  stocks:[
    {code:'00662',name:'å¯Œé‚¦NASDAQ',pct:35,color:'#4a9e65'},
    {code:'0050',name:'å…ƒå¤§å°ç£50',pct:30,color:'#7a9e87'},
    {code:'00878',name:'åœ‹æ³°æ°¸çºŒ',pct:25,color:'#e8c96a'},
    {code:'00830',name:'è²»åŸåŠå°é«”',pct:10,color:'#6b9fc9'},
  ],
  fixedTasks:[
    {id:'ft1',name:'æˆ¿è²¸',icon:'ğŸ ',amt:20000,cat:'æˆ¿è²¸'},
    {id:'ft2',name:'ç®¡ç†è²»',icon:'ğŸ¢',amt:2000,cat:'ç®¡ç†è²»'},
    {id:'ft3',name:'ç¶²è·¯è²»',icon:'ğŸŒ',amt:700,cat:'ç¶²è·¯è²»'},
    {id:'ft4',name:'æ°´è²»',icon:'ğŸ’§',amt:0,cat:'æ°´è²»'},
    {id:'ft5',name:'é›»è²»',icon:'âš¡',amt:0,cat:'é›»è²»'},
    {id:'ft6',name:'ç“¦æ–¯è²»',icon:'ğŸ”¥',amt:0,cat:'ç“¦æ–¯è²»'},
  ],
  fixedDone:{},   // [mKey][ftId] = 'auto'|'manual'|false
  tasks:[],       // [{id,name,amt,done}]
  months:{},
  // settled: [{person,desc,amt,settledAt,expTime}] â€” æ”¶å›ç´€éŒ„
  settled:[],
}}

let D = JSON.parse(localStorage.getItem('fireV10')||localStorage.getItem('fireV8')||'null') || defData();
// migrate from older versions
['fixedDone','tasks','months','settled','cats','fixedTasks'].forEach(k=>{if(!D[k])D[k]=defData()[k]});
if(!D.livingBudget)D.livingBudget=15000;
if(!D.subCats)D.subCats=defData().subCats;
// ensure new top-level cats exist
defData().cats.forEach(dc=>{if(!D.cats.find(c=>c.name===dc.name))D.cats.push(dc)});
// ensure new subCats exist
defData().subCats.forEach(dc=>{if(!D.subCats.find(c=>c.name===dc.name))D.subCats.push(dc)});
// strip any old sub-cats that snuck into top-level cats
const subNames=new Set(D.subCats.map(c=>c.name));
D.cats=D.cats.filter(c=>!subNames.has(c.name)||c.sys);

let CY=new Date().getFullYear(), CM=new Date().getMonth();
let selCat=null, selSubCat=null, curPM='cash', isAdv=false, advPersons=[], swEl=null, editFxIdx=-1, selClr=CLRS[0], selFxCat=null;
let settledShown=false, incListShown=false;

function mKey(y,m){return`${y}-${String(m+1).padStart(2,'0')}`}
function curKey(){return mKey(CY,CM)}
function curMD(){
  const k=curKey();
  if(!D.months[k])D.months[k]={expenses:[],incomes:[]};
  if(!D.months[k].incomes)D.months[k].incomes=[];
  return D.months[k];
}
function save(){localStorage.setItem('fireV10',JSON.stringify(D))}

// â”€â”€ Custom confirm (replaces window.confirm which is blocked in iframes) â”€â”€
function cfm(msg, onOk, title='ç¢ºèª', danger=true){
  document.getElementById('cfm-ttl').textContent=title;
  document.getElementById('cfm-msg').textContent=msg;
  const okBtn=document.getElementById('cfm-ok');
  okBtn.className='cfm-ok'+(danger?'':' safe');
  okBtn.onclick=()=>{cfmClose();onOk();};
  const modal=document.getElementById('cfm-modal');
  modal.style.display='flex';setTimeout(()=>modal.classList.add('open'),10);
}
function cfmClose(){
  const modal=document.getElementById('cfm-modal');
  modal.classList.remove('open');setTimeout(()=>modal.style.display='none',180);
}
function cmap(){
  // combined map of all cats + subCats (for display/color lookup)
  const m={};
  D.cats.forEach(c=>m[c.name]=c);
  D.subCats.forEach(c=>m[c.name]=c);
  return m;
}
function scmap(){return D.subCats.reduce((m,c)=>{m[c.name]=c;return m},{})}
function fmt(n){return'$'+Math.round(n).toLocaleString()}
function fmtDate(ts){
  const d=new Date(ts);
  return`${d.getMonth()+1}/${d.getDate()}`
}
function fmtDateFull(ts){
  const d=new Date(ts);
  return`${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PAGES / SHEETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-it').forEach(n=>n.classList.remove('active'));
  const m={'pg-home':'nav-home','pg-todo':'nav-todo','pg-analysis':'nav-analysis','pg-settings':'nav-settings'};
  if(m[id])document.getElementById(m[id]).classList.add('active');
  if(id==='pg-home')renderHome();
  if(id==='pg-todo')renderTodo();
  if(id==='pg-analysis')renderAnalysis();
  if(id==='pg-settings')renderSettings();
}
function openSheet(id){const e=document.getElementById(id);e.style.display='flex';setTimeout(()=>e.classList.add('open'),10)}
function closeSheet(id){const e=document.getElementById(id);e.classList.remove('open');setTimeout(()=>e.style.display='none',270)}
document.querySelectorAll('.sh-ov').forEach(o=>o.addEventListener('click',function(e){if(e.target===this)closeSheet(this.id)}));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome(){
  const md=curMD();
  const exps=md.expenses||[];
  const incs=md.incomes||[];
  const LBDG=D.livingBudget;

  const totInc=incs.reduce((s,i)=>s+i.amt,0);
  const totExp=exps.reduce((s,e)=>s+e.amt,0);
  const bal=totInc-totExp;

  document.getElementById('hdr-inc').textContent=fmt(totInc);
  document.getElementById('hdr-exp').textContent=fmt(totExp);
  document.getElementById('hdr-bank').textContent=fmt(D.bankValue);
  document.getElementById('ic-inc').textContent=fmt(totInc);
  document.getElementById('ic-exp').textContent=fmt(totExp);
  const balEl=document.getElementById('ic-bal');
  balEl.textContent=(bal>=0?'+':'')+fmt(Math.abs(bal));
  balEl.style.color=bal>=0?'var(--sage-dk)':'var(--rd)';
  document.getElementById('mo-btn').textContent=(CM+1)+'æœˆ â–¾';
  document.getElementById('an-mo-btn').textContent=(CM+1)+'æœˆ â–¾';
  document.getElementById('todo-mo-btn').textContent=(CM+1)+'æœˆ â–¾';

  // income toggle button
  const incToggle=document.getElementById('inc-toggle-btn');
  if(incs.length){
    incToggle.style.display='block';
    incToggle.textContent=incListShown?'â–² æ”¶åˆ':'â–¼ å±•é–‹ '+incs.length+' ç­†æ”¶å…¥æ˜ç´°';
    renderIncList();
  }else{
    incToggle.style.display='none';
    document.getElementById('inc-list').style.display='none';
  }

  // living
  const ls=exps.filter(e=>e.cat==='ç”Ÿæ´»è²»').reduce((s,e)=>s+e.amt,0);
  const lr=LBDG-ls, lp=ls/LBDG*100;
  document.getElementById('w-lv').textContent=fmt(lr);
  document.getElementById('w-lv-bar').style.width=Math.min(lp,100)+'%';
  const lbEl=document.getElementById('w-lv-bg');
  if(lp<60){lbEl.className='wbg ok';lbEl.textContent='âœ“ å……è£•';}
  else if(lp<85){lbEl.className='wbg warn';lbEl.textContent='âš  æ³¨æ„';}
  else{lbEl.className='wbg danger';lbEl.textContent='ğŸš¨ å¿«è¶…!';}

  // invest
  const iv=exps.filter(e=>e.cat==='æŠ•è³‡').reduce((s,e)=>s+e.amt,0);
  document.getElementById('w-iv').textContent=fmt(IV_BDG-iv);
  document.getElementById('w-iv-sp').textContent=fmt(iv);
  document.getElementById('w-iv-bar').style.width=Math.min(iv/IV_BDG*100,100)+'%';

  // daily budget
  const now=new Date();
  const thisMonth=CY===now.getFullYear()&&CM===now.getMonth();
  const dim=new Date(CY,CM+1,0).getDate();
  const daysLeft=thisMonth?Math.max(dim-now.getDate()+1,1):dim;
  const daily=daysLeft>0?Math.max(lr/daysLeft,0):0;
  const remPct=Math.max(100-lp,0);
  const arc=document.getElementById('day-arc');
  arc.style.strokeDashoffset=157.08*(1-remPct/100);
  arc.style.stroke=lp>=85?'var(--rd)':lp>=60?'var(--or)':'var(--yw)';
  const dn=document.getElementById('day-n1');
  dn.textContent=daily>=10000?'$'+Math.round(daily/1000)+'k':fmt(Math.floor(daily));
  dn.setAttribute('font-size',daily>=10000?'8':'9.5');
  document.getElementById('day-used-f').style.width=Math.min(lp,100)+'%';
  document.getElementById('day-used-f').style.background=lp>=85?'var(--rd)':lp>=60?'var(--or)':'var(--yw)';
  document.getElementById('day-rem-f').style.width=remPct+'%';
  document.getElementById('day-used-v').textContent=fmt(ls);
  document.getElementById('day-rem-v').textContent=fmt(Math.max(lr,0));
  document.getElementById('day-days').textContent=daysLeft;

  // payment (ç”Ÿæ´»è²» only)
  const lvE=exps.filter(e=>e.cat==='ç”Ÿæ´»è²»');
  const cash=lvE.filter(e=>e.pm==='cash').reduce((s,e)=>s+e.amt,0);
  const cc=lvE.filter(e=>e.pm==='cc').reduce((s,e)=>s+e.amt,0);
  const pmTot=cash+cc, pmRem=LBDG-pmTot;
  document.getElementById('pm-ca').textContent=fmt(cash);
  document.getElementById('pm-cc').textContent=fmt(cc);
  document.getElementById('pm-tot').textContent=fmt(pmTot);
  document.getElementById('pm-bgt-lbl').textContent=LBDG.toLocaleString();
  document.getElementById('pm-ca-bar').style.width=Math.min(cash/LBDG*100,100)+'%';
  document.getElementById('pm-cc-bar').style.width=Math.min(cc/LBDG*100,100)+'%';
  const remEl=document.getElementById('pm-rem');
  remEl.textContent=pmRem>=0?`å‰© ${fmt(pmRem)}`:`è¶…æ”¯ ${fmt(Math.abs(pmRem))}`;
  remEl.style.color=pmRem<0?'var(--rd)':'var(--sage-dk)';
  document.getElementById('pm-cc-col').className='pm-col'+(cc>LBDG*0.65?' alrt':'');

  renderStocks(exps);
  renderExpList(exps);
  document.getElementById('exp-sub').textContent='æœ¬æœˆ '+fmt(totExp);
  updNavDot();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TODO PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTodo(){
  renderAdvSection();
  renderFixedChecklist();
  renderCustomTasks();
  updNavDot();
}

// â”€â”€ ADVANCE SECTION â”€â”€
function getAdvByPerson(exps){
  const by={};
  exps.forEach(e=>{
    if(!e.isAdv||!e.advPersons||!e.advPersons.length)return;
    e.advPersons.forEach(p=>{
      if(!by[p])by[p]={total:0,items:[]};
      const amt=e.advAmts&&e.advAmts[p]!=null?e.advAmts[p]:
        Math.round((e.advAmt||e.amt)/e.advPersons.length);
      by[p].total+=amt;
      by[p].items.push({desc:e.desc||'ä»£å¢Š',amt,time:e.time});
    });
  });
  return by;
}

function renderAdvSection(){
  // collect ALL months' pending advances
  const by={};
  Object.entries(D.months).forEach(([mk,md])=>{
    const exps=md.expenses||[];
    const monthBy=getAdvByPerson(exps);
    Object.entries(monthBy).forEach(([p,data])=>{
      if(!by[p])by[p]={total:0,items:[]};
      by[p].total+=data.total;
      by[p].items.push(...data.items);
    });
  });
  const names=Object.keys(by);
  const grand=names.reduce((s,p)=>s+by[p].total,0);

  // grand badge
  const badge=document.getElementById('adv-grand-badge');
  if(grand>0){badge.textContent='åˆè¨ˆ '+fmt(grand);badge.style.display='';}
  else badge.style.display='none';

  const list=document.getElementById('adv-list');
  if(!names.length){
    list.innerHTML='<div class="adv-empty">ç›®å‰ç„¡å¾…è¿½è¨ä»£å¢Š<br><span style="font-size:10px">è¨˜å¸³æ™‚å‹¾é¸ã€ŒğŸ¤ æˆ‘å…ˆå¢Šã€å³å¯è¨˜éŒ„</span></div>';
  } else {
    list.innerHTML=names.map(p=>{
      const items=by[p].items.map(i=>
        `<div class="adv-item-row">
          <div><div class="adv-item-desc">${i.desc}</div>
          <div class="adv-item-dt">${fmtDate(i.time)}</div></div>
          <div class="adv-item-amt">${fmt(i.amt)}</div>
        </div>`).join('');
      return`<div class="adv-person-card">
        <div class="adv-person-top">
          <div class="adv-av">${p.slice(0,1)}</div>
          <div style="flex:1">
            <div class="adv-pname">${p}</div>
            <div style="font-size:10px;color:var(--tx3)">${by[p].items.length} ç­†ä»£å¢Š</div>
          </div>
          <div class="adv-ptot">${fmt(by[p].total)}</div>
          <button class="settle-btn" onclick="confirmSettle('${p}',${by[p].total})">âœ“ æ”¶å›</button>
        </div>
        ${items}
      </div>`;
    }).join('');
  }

  // settled history
  const settledSec=document.getElementById('settled-sec');
  const monthSettled=D.settled.filter(s=>s.settledAt&&
    new Date(s.settledAt).getFullYear()===CY&&new Date(s.settledAt).getMonth()===CM);
  if(monthSettled.length){
    settledSec.style.display='block';
    document.getElementById('settled-toggle-lbl').textContent=
      (settledShown?'â–¼':'â–¶')+` å·²æ”¶å›ç´€éŒ„ï¼ˆ${monthSettled.length} ç­†ï¼‰`;
    if(settledShown){
      document.getElementById('settled-list').innerHTML=monthSettled.map(s=>
        `<div class="settled-row">
          <div class="settled-ic">âœ“</div>
          <div style="flex:1">
            <div style="font-size:12px;font-weight:700">${s.person}</div>
            <div style="font-size:10px;color:var(--tx3)">${s.desc} Â· ${fmtDateFull(s.settledAt)}</div>
          </div>
          <div style="font-size:12px;font-weight:700;color:#2d8a5a">${fmt(s.amt)}</div>
        </div>`).join('');
    }
  } else settledSec.style.display='none';
}

function toggleSettled(){
  settledShown=!settledShown;
  const lst=document.getElementById('settled-list');
  lst.style.display=settledShown?'block':'none';
  renderAdvSection();
}

// settle confirm sheet
let pendingSettlePerson=null, pendingSettleAmt=0, settleRecordIncome=true;

function confirmSettle(person, amt){
  pendingSettlePerson=person; pendingSettleAmt=amt;
  settleRecordIncome=true;
  document.getElementById('settle-preview').innerHTML=
    `<div style="display:flex;align-items:center;gap:10px">
      <div style="width:42px;height:42px;border-radius:50%;background:var(--or);
        display:flex;align-items:center;justify-content:center;font-size:17px;font-weight:800;color:#fff">
        ${person.slice(0,1)}</div>
      <div style="flex:1">
        <div style="font-size:15px;font-weight:700">${person}</div>
        <div style="font-size:10px;color:var(--tx2);margin-top:2px">ä»£å¢Šå¾…è¿½è¨</div>
      </div>
      <div style="font-size:20px;font-weight:800;color:var(--or)">${fmt(amt)}</div>
    </div>`;
  // pre-fill
  document.getElementById('settle-amt').value=amt;
  document.getElementById('settle-desc').value=`${person} ä»£å¢Šé‚„æ¬¾`;
  // reset toggle to default = yes
  setSettleInc(true);
  document.getElementById('settle-confirm-btn').onclick=doSettle;
  openSheet('sh-settle');
}

function setSettleInc(yes){
  settleRecordIncome=yes;
  document.getElementById('settle-inc-yes').className='tgl'+(yes?' c':'');
  document.getElementById('settle-inc-no').className='tgl'+(yes?'':' c');
  document.getElementById('settle-inc-note').style.display=yes?'block':'none';
}

function doSettle(){
  const person=pendingSettlePerson;
  const amt=parseInt(document.getElementById('settle-amt').value)||pendingSettleAmt;
  const desc=document.getElementById('settle-desc').value.trim()||`${person} ä»£å¢Šé‚„æ¬¾`;

  // if record income = yes, add to current month incomes
  if(settleRecordIncome && amt>0){
    curMD().incomes.push({amt, desc, time:Date.now(), fromSettle:true});
  }

  // log settled record
  D.settled.push({person, desc, amt, settledAt:Date.now()});

  // remove person from all pending advances
  Object.values(D.months).forEach(md=>{
    (md.expenses||[]).forEach(e=>{
      if(e.isAdv&&e.advPersons){
        if(e.advAmts)delete e.advAmts[person];
        e.advPersons=e.advPersons.filter(p=>p!==person);
        if(!e.advPersons.length)e.isAdv=false;
      }
    });
  });

  save();
  closeSheet('sh-settle');
  renderTodo();
  // if income was recorded, also refresh home totals
  if(settleRecordIncome)renderHome();
}

// â”€â”€ FIXED CHECKLIST â”€â”€
function renderFixedChecklist(){
  const mk=curKey();
  if(!D.fixedDone[mk])D.fixedDone[mk]={};
  const fd=D.fixedDone[mk];
  const CHK=`<svg width="11" height="11" viewBox="0 0 12 12"><path d="M2 6l3 3 5-5" stroke="#fff" stroke-width="2.2" fill="none" stroke-linecap="round"/></svg>`;
  const exps=curMD().expenses||[];

  // auto-detect by category
  D.fixedTasks.forEach(t=>{
    if(!t.cat||fd[t.id]==='manual')return;
    const matched=exps.some(e=>e.cat===t.cat);
    if(matched)fd[t.id]='auto';
    else if(fd[t.id]==='auto')delete fd[t.id];
  });
  save();

  const done=D.fixedTasks.filter(t=>fd[t.id]).length;
  const tot=D.fixedTasks.length;
  document.getElementById('ck-fixed-prog').textContent=`${done}/${tot} å®Œæˆ`;

  document.getElementById('ck-fixed-list').innerHTML=D.fixedTasks.map((t,i)=>{
    const v=fd[t.id];
    const isAuto=v==='auto', isDone=!!v;
    return`<div class="ck-it" onclick="toggleFixed('${t.id}')">
      <div class="ck-box${isAuto?' au':isDone?' mn':''}">${isDone?CHK:''}</div>
      <div class="ck-lb${isDone?' dn':''}">${t.icon} ${t.name}</div>
      ${isAuto?`<span class="ck-badge ck-au-b">è‡ªå‹•</span>`:''}
      ${t.cat?`<span style="font-size:9px;color:var(--tx3)">${t.cat}</span>`:''}
      ${t.amt===0?`<span class="ck-badge ck-flex-b">æµ®å‹•</span>`:''}
      <div class="ck-amt">${t.amt===0?'â€”':fmt(t.amt)}</div>
      <button class="ck-ed" onclick="openEditFixed(event,${i})">âœ</button>
    </div>`;
  }).join('');

  if(done===tot&&tot>0){
    document.getElementById('ck-fixed-list').insertAdjacentHTML('beforeend',
      '<div class="ck-done-foot">ğŸ‰ æœ¬æœˆå›ºå®šæ”¯å‡ºå…¨éƒ¨å®Œæˆï¼</div>');
  }
}

function toggleFixed(id){
  const mk=curKey();
  if(!D.fixedDone[mk])D.fixedDone[mk]={};
  const cur=D.fixedDone[mk][id];
  D.fixedDone[mk][id]=cur?false:'manual';
  save();renderFixedChecklist();updNavDot();
}

// â”€â”€ CUSTOM TASKS â”€â”€
function renderCustomTasks(){
  const CHK=`<svg width="11" height="11" viewBox="0 0 12 12"><path d="M2 6l3 3 5-5" stroke="#fff" stroke-width="2.2" fill="none" stroke-linecap="round"/></svg>`;
  const el=document.getElementById('ck-custom-list');
  if(!D.tasks.length){
    el.innerHTML='<div class="adv-empty">é»å³ä¸Šã€Œï¼‹ã€æ–°å¢è‡ªè¨‚å¾…è¾¦</div>';return;
  }
  el.innerHTML=D.tasks.map((t,i)=>
    `<div class="ck-it" onclick="toggleTask(${i})">
      <div class="ck-box${t.done?' mn':''}">${t.done?CHK:''}</div>
      <div class="ck-lb${t.done?' dn':''}">${t.name}</div>
      ${t.amt?`<div class="ck-amt">${fmt(parseInt(t.amt))}</div>`:''}
      <button class="ck-ed" onclick="delTask(event,${i})">âœ•</button>
    </div>`).join('');
}
function toggleTask(i){D.tasks[i].done=!D.tasks[i].done;save();renderCustomTasks()}
function delTask(e,i){e.stopPropagation();D.tasks.splice(i,1);save();renderCustomTasks()}

function updNavDot(){
  const mk=curKey();
  const fd=D.fixedDone[mk]||{};
  const undone=D.fixedTasks.filter(t=>!fd[t.id]).length;
  const dot=document.getElementById('n-dot');
  dot.style.display=undone>0?'flex':'none';
  dot.textContent=undone>9?'9+':undone;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STOCKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStocks(exps){
  const alloc=document.getElementById('alloc-lbl');
  const tot=D.stockValue+D.bankValue;
  const bp=tot?D.bankValue/tot*100:30, sp=tot?D.stockValue/tot*100:70;
  document.getElementById('rt-ca').style.width=bp+'%';
  document.getElementById('rt-st').style.width=sp+'%';
  document.getElementById('rt-ca-p').textContent=bp.toFixed(0)+'%';
  document.getElementById('rt-st-p').textContent=sp.toFixed(0)+'%';
  const d=Math.abs(bp-30);
  alloc.textContent=d<3?'å‡è¡¡ âœ“':bp>33?'ç¾é‡‘åå¤š':'è‚¡ç¥¨åå¤š';
  alloc.style.color=d<3?'var(--sage-dk)':'#b08820';

  const hasInv=exps.some(e=>e.cat==='æŠ•è³‡');
  let h=hasInv?`<div style="display:flex;font-size:9px;color:var(--tx3);padding:0 0 3px">
    <div style="flex:1"></div>
    <div style="width:26px;text-align:right">%</div>
    <div style="width:44px;text-align:right">é ç®—</div>
    <div style="width:50px;text-align:right">å‰©é¤˜</div></div>`:''
  h+=D.stocks.map(s=>{
    const bgt=Math.round(IV_BDG*s.pct/100);
    const sp=exps.filter(e=>e.cat==='æŠ•è³‡'&&e.stockCode===s.code).reduce((s,e)=>s+e.amt,0);
    const rem=bgt-sp, p=bgt?Math.min(sp/bgt*100,100):0;
    const rc=rem<0?'var(--rd)':rem===bgt?'var(--tx3)':'var(--sage-dk)';
    return`<div class="sr">
      <div class="sr-dot" style="background:${s.color}"></div>
      <div class="sr-inf">
        <div class="sr-nm">${s.name}</div>
        <div class="sr-cd">${s.code}</div>
        ${hasInv?`<div class="sr-bar"><div class="sr-bf" style="width:${p}%;background:${s.color}"></div></div>`:''}</div>
      <div class="sr-pct">${s.pct}%</div>
      <div class="sr-bgt">${fmt(bgt)}</div>
      <div class="sr-rem" style="color:${rc}">${rem<0?'-':''}${fmt(Math.abs(rem))}</div>
    </div>`;
  }).join('');
  document.getElementById('sr-list').innerHTML=h;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXP LIST (with date groups)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderExpList(exps){
  const c=document.getElementById('exp-container');
  if(!exps.length){
    c.innerHTML=`<div class="empty-st"><div style="font-size:36px;opacity:.4;margin-bottom:8px">âœ¨</div>
      <div style="font-size:13px">æœ¬æœˆå°šç„¡è¨˜å¸³<br>é»å³ä¸Šã€Œè¨˜ä¸€ç­†ã€é–‹å§‹</div></div>`;return;
  }
  const cm=cmap();
  // group by day
  const grp={};
  exps.forEach((e,i)=>{
    const d=new Date(e.time);
    const dk=`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; // sort key
    const dl=`${d.getMonth()+1}æœˆ${d.getDate()}æ—¥ (${['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d.getDay()]})`; // display
    if(!grp[dk])grp[dk]={label:dl,items:[]};
    grp[dk].items.push({...e,idx:i});
  });
  const now=new Date();
  const todayKey=`${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;
  const yest=new Date(now); yest.setDate(now.getDate()-1);
  const yestKey=`${yest.getFullYear()}-${yest.getMonth()+1}-${yest.getDate()}`;

  c.innerHTML=Object.keys(grp).sort().reverse().map(dk=>{
    const g=grp[dk];
    const lbl=dk===todayKey?'ä»Šå¤©':dk===yestKey?'æ˜¨å¤©':g.label;
    const dayTotal=g.items.reduce((s,e)=>s+e.amt,0);
    return`<div class="exp-grp">
      <div class="exp-dt-hdr">
        <div class="exp-dt-lbl">${lbl}</div>
        <div class="exp-dt-amt">-${fmt(dayTotal)}</div>
      </div>`+
      g.items.reverse().map(e=>{
        const cat=cm[e.cat]||{icon:'ğŸ’°',color:'#7a9e87'};
        const subC=e.subCat?cm[e.subCat]:null;
        const displayIcon=subC?subC.icon:cat.icon;
        const displayColor=subC?subC.color:cat.color;
        const pm=e.pm==='cc'?'ğŸ’³':'ğŸ’µ';
        const catLabel=e.subCat?`${e.cat} Â· ${e.subCat}`:e.cat;
        const advTag=e.isAdv&&e.advPersons&&e.advPersons.length
          ?`<div class="exp-adv">ğŸ¤ ä»£å¢Š ${e.advPersons.join('Â·')} ${fmt(e.advAmt||0)}</div>`:'';
        return`<div class="exp-it" id="ei-${e.idx}" onclick="swItem(${e.idx})">
          <div class="exp-ic" style="background:${displayColor}22">${displayIcon}</div>
          <div class="exp-inf">
            <div class="exp-nm">${e.desc||e.cat}</div>
            <div class="exp-me">${catLabel}${e.stockCode?' Â· '+e.stockCode:''} Â· ${pm}</div>
            ${advTag}
          </div>
          <div class="exp-am">-${fmt(e.amt)}</div>
          <button class="del-btn" onclick="delExp(event,${e.idx})">åˆªé™¤</button>
        </div>`;
      }).join('')+'</div>';
  }).join('');
}
function swItem(idx){
  if(swEl&&swEl!==`ei-${idx}`)document.getElementById(swEl)?.classList.remove('sw');
  const el=document.getElementById(`ei-${idx}`);
  if(!el)return;
  el.classList.toggle('sw');
  swEl=el.classList.contains('sw')?`ei-${idx}`:null;
}
function delExp(e,idx){e.stopPropagation();curMD().expenses.splice(idx,1);save();renderHome()}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADD EXPENSE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAddExp(){
  selCat=D.cats[0]?.name;   // default to first top-level (ç”Ÿæ´»è²»)
  selSubCat=D.subCats[0]?.name; // default sub
  curPM='cash'; isAdv=false; advPersons=[];
  buildMainPills();
  buildSubPills();
  updCatUI(selCat);
  document.getElementById('pm-ca-btn').className='tgl c';
  document.getElementById('pm-cc-btn').className='tgl';
  document.getElementById('adv-no-btn').style.cssText='border-color:var(--bd);background:var(--card2);color:var(--tx2)';
  document.getElementById('adv-yes-btn').className='tgl';
  document.getElementById('adv-box').className='adv-box';
  document.getElementById('adv-rows').innerHTML='';
  document.getElementById('adv-total').textContent='$0';
  document.getElementById('adv-inp').value='';
  // recent persons
  const seen=new Set();
  Object.values(D.months).forEach(md=>(md.expenses||[]).forEach(e=>
    e.advPersons&&e.advPersons.forEach(p=>seen.add(p))));
  const recent=[...seen].slice(0,5);
  document.getElementById('adv-quick').innerHTML=recent.length
    ?'<div style="font-size:10px;color:var(--or);margin-bottom:4px">æœ€è¿‘ï¼š</div>'+
      recent.map(p=>`<button class="adv-qb" onclick="advQuickAdd('${p}')">${p}</button>`).join('')
    :'';
  openSheet('sh-exp');
  setTimeout(()=>document.getElementById('e-amt').focus(),350);
}

function buildMainPills(){
  const sel=selCat;
  document.getElementById('e-pills').innerHTML=D.cats.map(c=>{
    const isSel=c.name===sel;
    return`<button class="cpill${isSel?' sel':''}"
      style="${isSel?`background:${c.color};border-color:${c.color}`:''}"
      onclick="pickCat('${c.name}')">${c.icon} ${c.name}</button>`;
  }).join('');
}

function buildSubPills(){
  const sel=selSubCat;
  document.getElementById('e-sub-pills').innerHTML=D.subCats.map(c=>{
    const isSel=c.name===sel;
    return`<button class="cpill${isSel?' sel':''}"
      style="${isSel?`background:${c.color};border-color:${c.color}`:''}"
      onclick="pickSubCat('${c.name}')">${c.icon} ${c.name}</button>`;
  }).join('');
}

function pickCat(name){
  selCat=name;
  // reset sub selection to first
  if(name==='ç”Ÿæ´»è²»')selSubCat=D.subCats[0]?.name;
  buildMainPills();
  updCatUI(name);
}

function pickSubCat(name){
  selSubCat=name;
  // rebuild sub pills to show selection
  document.querySelectorAll('#e-sub-pills .cpill').forEach(p=>{
    p.classList.remove('sel');p.style.background='';p.style.borderColor='';});
  const c=scmap()[name];
  // find the button by its text content match â€“ simpler: rebuild
  buildSubPills();
}

function updCatUI(cat){
  // sub-category row
  document.getElementById('e-sub-wrap').style.display=cat==='ç”Ÿæ´»è²»'?'block':'none';
  // stock row
  const w=document.getElementById('e-stk-wrap');
  if(cat==='æŠ•è³‡'){
    w.style.display='block';
    document.getElementById('e-stk').innerHTML=D.stocks.map(s=>
      `<option value="${s.code}">${s.name}ï¼ˆ${s.code}ï¼‰</option>`).join('');
  }else w.style.display='none';
}
function setPM(pm){
  curPM=pm;
  document.getElementById('pm-ca-btn').className='tgl'+(pm==='cash'?' c':'');
  document.getElementById('pm-cc-btn').className='tgl'+(pm==='cc'?' cc':'');
}
function setAdv(on){
  isAdv=on;
  document.getElementById('adv-no-btn').style.cssText=on
    ?'border-color:var(--bd);background:var(--card2);color:var(--tx2)':'';
  document.getElementById('adv-no-btn').className='tgl'+(on?'':' c');
  document.getElementById('adv-yes-btn').className='tgl'+(on?' yes':'');
  document.getElementById('adv-box').className='adv-box'+(on?' show':'');
  if(on)setTimeout(()=>document.getElementById('adv-inp').focus(),100);
}
function advAdd(name){
  const inp=document.getElementById('adv-inp');
  const n=name||(inp.value.trim());
  if(!n||advPersons.find(p=>p.name===n))return;
  advPersons.push({name:n,amt:0});
  if(!name)inp.value='';
  renderAdvRows();
}
function advQuickAdd(n){advAdd(n)}
function advRm(name){advPersons=advPersons.filter(p=>p.name!==name);renderAdvRows()}
function advUpdAmt(name,v){
  const p=advPersons.find(p=>p.name===name);
  if(p){p.amt=parseInt(v)||0;updAdvTotal();}
}
function renderAdvRows(){
  document.getElementById('adv-rows').innerHTML=advPersons.map(p=>`
    <div class="adv-person-row">
      <div class="adv-pn">${p.name}</div>
      <span style="font-size:13px;color:var(--tx3);font-weight:700">$</span>
      <input class="adv-pi" type="number" value="${p.amt||''}" placeholder="0"
        inputmode="decimal"
        onchange="advUpdAmt('${p.name}',this.value)"
        oninput="advUpdAmt('${p.name}',this.value)">
      <button class="adv-prm" onclick="advRm('${p.name}')">âœ•</button>
    </div>`).join('');
  updAdvTotal();
}
function updAdvTotal(){
  const tot=advPersons.reduce((s,p)=>s+(p.amt||0),0);
  document.getElementById('adv-total').textContent=fmt(tot);
}
function submitExp(){
  const amt=parseInt(document.getElementById('e-amt').value);
  if(!amt||amt<=0){document.getElementById('e-amt').focus();return;}
  const desc=document.getElementById('e-desc').value.trim();
  const cat=selCat||D.cats[0]?.name;
  const subCat=(cat==='ç”Ÿæ´»è²»'&&selSubCat)?selSubCat:undefined;
  const stk=cat==='æŠ•è³‡'?document.getElementById('e-stk').value:undefined;
  const rec={amt,desc:desc||cat,cat,subCat,pm:curPM,stockCode:stk,time:Date.now()};
  if(isAdv&&advPersons.length){
    rec.isAdv=true;
    rec.advPersons=advPersons.map(p=>p.name);
    rec.advAmts=Object.fromEntries(advPersons.map(p=>[p.name,p.amt||0]));
    rec.advAmt=advPersons.reduce((s,p)=>s+(p.amt||0),0);
  }
  curMD().expenses.push(rec);
  save();closeSheet('sh-exp');
  document.getElementById('e-amt').value='';
  document.getElementById('e-desc').value='';
  renderHome();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INCOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAddIncome(){
  document.getElementById('inc-amt').value='';
  document.getElementById('inc-desc').value='';
  openSheet('sh-income');
  setTimeout(()=>document.getElementById('inc-amt').focus(),350);
}
function submitIncome(){
  const amt=parseInt(document.getElementById('inc-amt').value);
  if(!amt||amt<=0)return;
  curMD().incomes.push({amt,desc:document.getElementById('inc-desc').value.trim()||'æ”¶å…¥',time:Date.now()});
  save();closeSheet('sh-income');renderHome();
}
function toggleIncList(){
  incListShown=!incListShown;
  renderIncList();
  const btn=document.getElementById('inc-toggle-btn');
  const incs=curMD().incomes||[];
  btn.textContent=incListShown?'â–² æ”¶åˆ':'â–¼ å±•é–‹ '+incs.length+' ç­†æ”¶å…¥æ˜ç´°';
}
function renderIncList(){
  const el=document.getElementById('inc-list');
  const incs=curMD().incomes||[];
  if(!incListShown||!incs.length){el.style.display='none';return;}
  el.style.display='block';
  el.innerHTML=incs.map((inc,i)=>{
    const d=new Date(inc.time);
    const dt=`${d.getMonth()+1}/${d.getDate()}`;
    const badge=inc.fromSettle
      ?`<span style="font-size:9px;background:var(--or-bg);color:var(--or);
          padding:1px 5px;border-radius:5px;font-weight:700;margin-left:4px">ä»£å¢Šé‚„æ¬¾</span>`:''
    return`<div style="display:flex;align-items:center;gap:8px;padding:6px 0;
      border-bottom:1px solid var(--bd)${i===incs.length-1?';border-bottom:none':''}">
      <div style="width:28px;height:28px;border-radius:9px;background:var(--gr-bg);
        display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0">ğŸ’š</div>
      <div style="flex:1;min-width:0">
        <div style="font-size:12px;font-weight:600">${inc.desc}${badge}</div>
        <div style="font-size:10px;color:var(--tx3)">${dt}</div>
      </div>
      <div style="font-size:13px;font-weight:700;color:#2d8a5a">+${fmt(inc.amt)}</div>
      <button onclick="delIncome(${i})" style="background:none;border:none;cursor:pointer;
        color:var(--tx3);font-size:14px;padding:2px 5px;flex-shrink:0">âœ•</button>
    </div>`;
  }).join('');
}
function delIncome(i){
  const incs=curMD().incomes||[];
  cfm(`åˆªé™¤ã€Œ${incs[i].desc}ã€${fmt(incs[i].amt)}ï¼Ÿ`,()=>{
    incs.splice(i,1);save();renderHome();
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TASKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAddTask(){
  document.getElementById('task-nm').value='';document.getElementById('task-amt').value='';
  openSheet('sh-task');setTimeout(()=>document.getElementById('task-nm').focus(),350);
}
function submitTask(){
  const nm=document.getElementById('task-nm').value.trim();if(!nm)return;
  const amt=document.getElementById('task-amt').value;
  D.tasks.push({id:'t'+Date.now(),name:nm,amt:amt||0,done:false});
  save();closeSheet('sh-task');renderCustomTasks();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FIXED TASKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openEditFixed(e,idx){
  e.stopPropagation();editFxIdx=idx;
  const t=D.fixedTasks[idx];
  document.getElementById('sh-fixed-ttl').textContent='ç·¨è¼¯ï¼š'+t.name;
  document.getElementById('fx-nm').value=t.name;
  document.getElementById('fx-ico').value=t.icon;
  document.getElementById('fx-amt').value=t.amt;
  selFxCat=t.cat||null;
  buildFxCatPills();
  openSheet('sh-fixed');
}
function openAddFixed(){
  editFxIdx=-1;
  document.getElementById('sh-fixed-ttl').textContent='æ–°å¢å›ºå®šæ”¯å‡º';
  document.getElementById('fx-nm').value='';document.getElementById('fx-ico').value='';
  document.getElementById('fx-amt').value='';selFxCat=null;
  buildFxCatPills();openSheet('sh-fixed');
}
function buildFxCatPills(){
  document.getElementById('fx-cat-pills').innerHTML=
    [{name:'ï¼ˆä¸ç¶å®šï¼‰',icon:'',color:'#aaa'},  ...D.cats].map(c=>{
      const isSel=c.name===selFxCat||(c.name==='ï¼ˆä¸ç¶å®šï¼‰'&&!selFxCat);
      return`<button class="cpill${isSel?' sel':''}" id="fxp-${c.name}"
        style="${isSel?`background:${c.color};border-color:${c.color}`:''}"
        onclick="pickFxCat('${c.name}')">${c.icon} ${c.name}</button>`;
    }).join('');
}
function pickFxCat(name){
  selFxCat=name==='ï¼ˆä¸ç¶å®šï¼‰'?null:name;
  document.querySelectorAll('#fx-cat-pills .cpill').forEach(p=>{
    p.classList.remove('sel');p.style.background='';p.style.borderColor='';});
  const key=selFxCat||'ï¼ˆä¸ç¶å®šï¼‰';
  const p=document.getElementById(`fxp-${key}`);
  const c=selFxCat?cmap()[selFxCat]:{color:'#aaa'};
  if(p){p.classList.add('sel');p.style.background=c.color;p.style.borderColor=c.color;}
}
function submitFixed(){
  const nm=document.getElementById('fx-nm').value.trim();if(!nm)return;
  const obj={
    id:editFxIdx>=0?D.fixedTasks[editFxIdx].id:'ft'+Date.now(),
    name:nm,icon:document.getElementById('fx-ico').value||'ğŸ“Œ',
    amt:parseInt(document.getElementById('fx-amt').value)||0,
    cat:selFxCat||null
  };
  if(editFxIdx>=0)D.fixedTasks[editFxIdx]=obj;else D.fixedTasks.push(obj);
  save();closeSheet('sh-fixed');
  renderFixedChecklist();renderSettings();
}
function delFixed(i){
  cfm(`åˆªé™¤ã€Œ${D.fixedTasks[i].name}ã€ï¼Ÿ`,()=>{
    D.fixedTasks.splice(i,1);save();renderFixedChecklist();renderSettings();
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUDGET / ASSETS / INVEST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openBudgetEdit(){document.getElementById('budget-inp').value=D.livingBudget;openSheet('sh-budget')}
function saveBudget(){const v=parseInt(document.getElementById('budget-inp').value);if(v>0){D.livingBudget=v;save();}closeSheet('sh-budget');renderHome();renderSettings();}
function openAssetEdit(){
  document.getElementById('a-stk').value=D.stockValue;
  document.getElementById('a-bank').value=D.bankValue;
  prvAlloc();openSheet('sh-asset');
}
function prvAlloc(){
  const s=parseInt(document.getElementById('a-stk').value)||0;
  const b=parseInt(document.getElementById('a-bank').value)||0;
  const t=s+b,bp=t?b/t*100:30,sp=t?s/t*100:70;
  document.getElementById('pv-ca').style.width=bp+'%';document.getElementById('pv-st').style.width=sp+'%';
  document.getElementById('pv-cp').textContent=bp.toFixed(0)+'%';document.getElementById('pv-sp').textContent=sp.toFixed(0)+'%';
}
function saveAssets(){
  D.stockValue=parseInt(document.getElementById('a-stk').value)||0;
  D.bankValue=parseInt(document.getElementById('a-bank').value)||0;
  save();closeSheet('sh-asset');renderHome();renderSettings();
}
function openInvestEdit(){
  document.getElementById('iv-edit-body').innerHTML=D.stocks.map((s,i)=>`
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <div style="width:10px;height:10px;border-radius:3px;background:${s.color};flex-shrink:0"></div>
      <div style="flex:1;font-size:13px;font-weight:600">${s.name}<br><span style="font-size:10px;color:var(--tx3)">${s.code}</span></div>
      <input type="number" value="${s.pct}" style="width:55px;font-size:16px;font-weight:700;text-align:right;
        border:1.5px solid var(--bd);border-radius:8px;padding:4px 7px;font-family:inherit"
        oninput="updIvPct(${i},this.value)"> %
    </div>`).join('');
  updTotPct();openSheet('sh-invest');
}
function updIvPct(i,v){D.stocks[i].pct=parseInt(v)||0;save();updTotPct()}
function updTotPct(){document.getElementById('iv-tot-p').textContent=D.stocks.reduce((s,x)=>s+x.pct,0)+'%'}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MONTH PICKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openMoPicker(){
  document.getElementById('mo-grid').innerHTML=Array.from({length:12},(_,i)=>{
    const k=mKey(CY,i),has=!!(D.months[k]&&(D.months[k].expenses||[]).length);
    const sel=i===CM;
    return`<button class="mo-opt${sel?' sel':has?' has':''}" onclick="selMonth(${i})">${i+1}æœˆ</button>`;
  }).join('');
  openSheet('sh-mo');
}
function selMonth(m){CM=m;closeSheet('sh-mo');
  const active=document.querySelector('.page.active');
  if(active.id==='pg-home')renderHome();
  else if(active.id==='pg-todo')renderTodo();
  else renderHome();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ANALYSIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAnalysis(){
  const exps=curMD().expenses||[];
  const tot=D.stockValue+D.bankValue,pct=Math.min(tot/GOAL*100,100);
  document.getElementById('a-tot').textContent=fmt(tot);
  document.getElementById('a-gb').style.width=pct+'%';
  document.getElementById('a-pct').textContent=pct.toFixed(1)+'%';
  document.getElementById('a-rem').textContent='é‚„å·® '+fmt(Math.max(GOAL-tot,0));
  // Build chart data: for ç”Ÿæ´»è²» expenses, group by subCat; others by cat
  const grp={};
  exps.forEach(e=>{
    if(e.cat==='ç”Ÿæ´»è²»'&&e.subCat){
      const key=`ğŸ›’ ${e.subCat}`;
      grp[key]=(grp[key]||0)+e.amt;
    }else{
      grp[e.cat]=(grp[e.cat]||0)+e.amt;
    }
  });
  const totAmt=Object.values(grp).reduce((a,b)=>a+b,0);
  const cm=cmap();
  const canvas=document.getElementById('donut');
  const ctx=canvas.getContext('2d');
  const W=canvas.width,R=W/2,r1=R*.7,r2=R*.4;
  ctx.clearRect(0,0,W,W);
  if(!totAmt){ctx.fillStyle='#e0ebe4';ctx.beginPath();ctx.arc(R,R,r1,0,Math.PI*2);ctx.arc(R,R,r2,0,Math.PI*2,true);ctx.fill();}
  else{let a=-Math.PI/2;Object.entries(grp).forEach(([cat,val])=>{
    const sw=val/totAmt*Math.PI*2;
    ctx.beginPath();ctx.moveTo(R,R);ctx.arc(R,R,r1,a,a+sw);ctx.arc(R,R,r2,a+sw,a,true);ctx.closePath();
    ctx.fillStyle=(cm[cat]||{color:'#aaa'}).color+'cc';ctx.fill();a+=sw;
  });}
  document.getElementById('donut-leg').innerHTML=Object.entries(grp).sort((a,b)=>b[1]-a[1]).map(([cat,val])=>{
    const c=cm[cat]||{icon:'ğŸ’°',color:'#aaa'};const p=totAmt?val/totAmt*100:0;
    return`<div class="li-row">
      <div class="li-ic" style="background:${c.color}22">${c.icon}</div>
      <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:600">${cat}</div>
        <div class="li-bg"><div class="li-bf" style="width:${p}%;background:${c.color}"></div></div></div>
      <div class="li-am">-${fmt(val)}</div></div>`;
  }).join('');
  const yr=document.getElementById('year-list');
  const mths=Object.keys(D.months).filter(k=>k.startsWith(CY+'-')).sort().reverse();
  yr.innerHTML=mths.map(k=>{
    const md=D.months[k],totE=(md.expenses||[]).reduce((s,e)=>s+e.amt,0);
    const[y,m]=k.split('-'),mo=parseInt(m)-1;
    return`<div style="background:var(--card);border-radius:12px;padding:10px 13px;margin-bottom:7px;
      box-shadow:0 1px 3px rgba(0,0,0,.04);display:flex;align-items:center;gap:9px;cursor:pointer"
      onclick="CM=${mo};showPage('pg-home')">
      <div style="width:36px;height:36px;border-radius:10px;background:var(--sage-pl);display:flex;
        align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--sage-dk)">${parseInt(m)}æœˆ</div>
      <div style="flex:1"><div style="font-size:13px;font-weight:600">${y}å¹´${parseInt(m)}æœˆ</div>
        <div style="font-size:10px;color:var(--tx3)">${(md.expenses||[]).length} ç­†æ¶ˆè²»</div></div>
      <div style="font-size:14px;font-weight:700">-${fmt(totE)}</div></div>`;
  }).join('')||'<div class="empty-st"><div style="font-size:36px;opacity:.4">ğŸ“Š</div><div style="font-size:13px;margin-top:6px">ä»Šå¹´å°šç„¡è¨˜å¸³</div></div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSettings(){
  document.getElementById('st-asset-sb').textContent=`è‚¡ç¥¨ ${fmt(D.stockValue)} ï½œç¾é‡‘ ${fmt(D.bankValue)}`;
  document.getElementById('st-bgt-sb').textContent=fmt(D.livingBudget)+' / æœˆ';
  document.getElementById('st-fixed-sec').innerHTML=D.fixedTasks.map((t,i)=>
    `<div class="st-row">
      <div class="st-ri" style="background:var(--card2)">${t.icon}</div>
      <div class="st-rt" onclick="openEditFixed(event,${i})">
        <div class="st-tt">${t.name}</div>
        <div class="st-sb">${t.amt===0?'æµ®å‹•é‡‘é¡':fmt(t.amt)}${t.cat?' Â· é¡åˆ¥ï¼š'+t.cat:''}</div>
      </div>
      <button style="background:none;border:none;color:var(--rd);cursor:pointer;padding:4px 8px;font-size:15px"
        onclick="delFixed(${i})">ğŸ—‘</button>
    </div>`).join('')+
  `<div class="st-row" onclick="openAddFixed()">
    <div class="st-ri" style="background:#e8f2ec">ï¼‹</div>
    <div class="st-rt"><div class="st-tt">æ–°å¢å›ºå®šæ”¯å‡º</div></div>
    <div class="st-ar">â€º</div>
  </div>`;
  document.getElementById('st-cats').innerHTML=D.cats.map((c,i)=>
    `<div style="display:flex;align-items:center;gap:4px;padding:4px 9px;border-radius:12px;
      font-size:11px;font-weight:600;border:1.5px solid var(--bd);background:var(--card2)">
      ${c.icon} ${c.name}
      ${!c.sys?`<button style="width:15px;height:15px;border-radius:50%;background:var(--bd);border:none;
        cursor:pointer;font-size:9px;color:var(--tx2);display:flex;align-items:center;justify-content:center"
        onclick="rmCat(${i})">âœ•</button>`:''}
    </div>`).join('');
  document.getElementById('st-subcats').innerHTML=D.subCats.map((c,i)=>
    `<div style="display:flex;align-items:center;gap:4px;padding:4px 9px;border-radius:12px;
      font-size:11px;font-weight:600;border:1.5px solid ${c.color};background:${c.color}18">
      ${c.icon} ${c.name}
      <button style="width:15px;height:15px;border-radius:50%;background:${c.color}44;border:none;
        cursor:pointer;font-size:9px;color:${c.color};display:flex;align-items:center;justify-content:center"
        onclick="rmSubCat(${i})">âœ•</button>
    </div>`).join('');
}

let selSubClr=CLRS[3];
function openAddSubCat(){
  document.getElementById('sc-nm').value='';document.getElementById('sc-ico').value='';
  selSubClr=CLRS[3];
  document.getElementById('sc-clrs').innerHTML=CLRS.map(c=>
    `<div class="cdot${c===selSubClr?' sel':''}" style="background:${c}"
      onclick="pickSubClr(this,'${c}')"></div>`).join('');
  openSheet('sh-subcat');
}
function pickSubClr(el,c){
  selSubClr=c;
  document.querySelectorAll('#sc-clrs .cdot').forEach(d=>d.classList.remove('sel'));
  el.classList.add('sel');
}
function submitSubCat(){
  const nm=document.getElementById('sc-nm').value.trim();
  if(!nm){alert('è«‹è¼¸å…¥åç¨±');return;}
  if(D.subCats.find(c=>c.name===nm)){alert('å­é¡åˆ¥å·²å­˜åœ¨');return;}
  D.subCats.push({name:nm,icon:document.getElementById('sc-ico').value||'ğŸ“Œ',color:selSubClr});
  save();closeSheet('sh-subcat');renderSettings();buildSubPills();
}
function openAddCat(){
  document.getElementById('nc-nm').value='';document.getElementById('nc-ico').value='';
  selClr=CLRS[0];
  document.getElementById('nc-clrs').innerHTML=CLRS.map(c=>
    `<div class="cdot${c===selClr?' sel':''}" style="background:${c}" onclick="pickClr(this,'${c}')"></div>`
  ).join('');openSheet('sh-cat');
}
function pickClr(el,c){selClr=c;document.querySelectorAll('.cdot').forEach(d=>d.classList.remove('sel'));el.classList.add('sel')}
function submitCat(){
  const nm=document.getElementById('nc-nm').value.trim();
  if(!nm){alert('è«‹è¼¸å…¥åç¨±');return;}
  if(D.cats.find(c=>c.name===nm)){alert('é¡åˆ¥å·²å­˜åœ¨');return;}
  D.cats.push({name:nm,icon:document.getElementById('nc-ico').value||'ğŸ’¡',color:selClr});
  save();closeSheet('sh-cat');renderSettings();
}
function rmCat(i){cfm(`åˆªé™¤ã€Œ${D.cats[i].name}ã€é¡åˆ¥ï¼Ÿ`,()=>{D.cats.splice(i,1);save();renderSettings()});}
function rmSubCat(i){cfm(`åˆªé™¤ã€Œ${D.subCats[i].name}ã€å­é¡åˆ¥ï¼Ÿ`,()=>{D.subCats.splice(i,1);save();renderSettings();});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA MGMT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportData(){
  const a=document.createElement('a');
  a.href='data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(D,null,2));
  a.download='fire-tracker-backup.json';
  document.body.appendChild(a);a.click();document.body.removeChild(a);
}
function importData(){
  const inp=document.createElement('input');inp.type='file';inp.accept='.json';
  inp.onchange=e=>{
    const r=new FileReader();
    r.onload=ev=>{
      try{
        const parsed=JSON.parse(ev.target.result);
        // basic validation
        if(!parsed.cats&&!parsed.months)throw new Error('æ ¼å¼éŒ¯èª¤');
        D=parsed;
        // ensure required fields
        ['fixedDone','tasks','months','settled','cats','fixedTasks'].forEach(k=>{if(!D[k])D[k]=defData()[k]});
        if(!D.subCats)D.subCats=defData().subCats;
        if(!D.livingBudget)D.livingBudget=15000;
        save();showPage('pg-home');alert('âœ“ åŒ¯å…¥æˆåŠŸï¼');
      }catch(err){alert('åŒ¯å…¥å¤±æ•—ï¼š'+err.message);}
    };
    r.readAsText(e.target.files[0]);
  };
  document.body.appendChild(inp);inp.click();document.body.removeChild(inp);
}
function clearAll(){
  cfm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è¨˜å¸³è³‡æ–™ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼',()=>{
    ['fireV8','fireV9','fireV10'].forEach(k=>localStorage.removeItem(k));
    D=defData();save();showPage('pg-home');renderSettings();
  },'æ¸…é™¤æ‰€æœ‰è³‡æ–™',true);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KEY EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('e-amt').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('e-desc').focus()});
document.getElementById('e-desc').addEventListener('keydown',e=>{if(e.key==='Enter')submitExp()});
document.getElementById('adv-inp').addEventListener('keydown',e=>{if(e.key==='Enter')advAdd()});
document.getElementById('inc-amt').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('inc-desc').focus()});
document.getElementById('inc-desc').addEventListener('keydown',e=>{if(e.key==='Enter')submitIncome()});
document.getElementById('task-nm').addEventListener('keydown',e=>{if(e.key==='Enter')submitTask()});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderHome();

// â”€â”€ Quick Launch: ç¶²å€åŠ  ?add ç›´æ¥é–‹è¨˜å¸³ç•«é¢ â”€â”€
(function(){
  if(new URLSearchParams(location.search).has('add'))
    setTimeout(()=>openAddExp(),400);
})();

// â”€â”€ Scriptable Widget Data: ç¶²å€åŠ  ?widget=1 å›å‚³ JSON â”€â”€
(function(){
  if(!new URLSearchParams(location.search).has('widget'))return;
  const md=curMD();
  const exps=md.expenses||[], incs=md.incomes||[];
  const ls=exps.filter(e=>e.cat==='ç”Ÿæ´»è²»').reduce((s,e)=>s+e.amt,0);
  const totInc=incs.reduce((s,i)=>s+i.amt,0);
  const totExp=exps.reduce((s,e)=>s+e.amt,0);
  const now=new Date(), dim=new Date(CY,CM+1,0).getDate();
  const daysLeft=Math.max(dim-now.getDate()+1,1);
  const data={
    month:(CM+1)+'æœˆ', livingBudget:D.livingBudget,
    livingSpent:ls, livingLeft:D.livingBudget-ls,
    dailyLeft:Math.floor(Math.max(D.livingBudget-ls,0)/daysLeft),
    daysLeft, totalIncome:totInc, totalExpense:totExp,
    balance:totInc-totExp, updatedAt:new Date().toISOString()
  };
  document.open();
  document.write('<pre style="font:14px/1.6 monospace;padding:20px;background:#1a1a2e;color:#e8c96a">'+
    JSON.stringify(data,null,2)+'</pre>');
  document.close();
})();
</script>
</body>
</html>
